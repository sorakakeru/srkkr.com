<!DOCTYPE html><html lang="ja"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><meta name="format-detection" content="telephone=no"><title>AT Protocolを利用してBlueskyに投稿したり投稿を取得したりなど || srkkr.com</title><meta name="description" content>
        <meta property="og:title" content="AT Protocolを利用してBlueskyに投稿したり投稿を取得したりなど">
        <meta property="og:type" content="article">
        <meta property="og:description" content>
        <meta property="og:site_name" content="srkkr.com"><meta property="og:locale" content="ja_JP"><meta property="og:url" content="https://srkkr.com/article/bluesky-atprotocol-ts/"><meta property="og:image" content="https://srkkr.com/images/og.png"><link rel="manifest" href="/favicon/manifest.webmanifest"><link rel="icon" href="/favicon/favicon.ico" sizes="32x32"><link rel="icon" href="/favicon/icon.svg" type="image/svg+xml"><link rel="apple-touch-icon" href="/favicon/apple-touch-icon.png"><link rel="canonical" href="https://srkkr.com/article/bluesky-atprotocol-ts/"><style>body,p,h1,h2,h3,h4,h5,h6,ul,ol,figure,figcaption{margin:0;padding:0}table{border-collapse:collapse}*,*:before,*:after{box-sizing:border-box}:root{--baseColor: #1f2937;--primaryColor: #207b7e;--whiteColor: #fefefe;--bgColor: #fefefe;--grayColor: #ccc}html{scroll-behavior:smooth}body{color:var(--baseColor);font-size:1rem;font-family:Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;line-height:1.8;background-color:var(--bgColor)}img,picture *{font-style:italic;vertical-align:middle;max-width:100%;height:auto}h1,h2,h3,h4,h5,h6,strong{font-weight:700}a{transition:all .3s}a:link,a:visited{color:var(--primaryColor);text-decoration:underline}a:hover,a:active{color:var(--baseColor);text-decoration:none}.wrapper{margin-inline:auto;padding:3.5em 0;width:min(90%,800px)}.header{margin-bottom:3em}h1{font-size:1.25em}h2{margin-bottom:.5em;font-size:1.1em}.main{margin-bottom:3em;padding-bottom:3em;border-bottom:1px dashed var(--grayColor)}ul,ol{margin-left:1.5em}.footer{text-align:center}.footer .icon{margin-bottom:.5em}.footer .icon img{border-radius:50%}.footer address{margin-bottom:1.5em;font-style:normal}.footer small{font-size:.85em}@media screen and (max-width:739px){.advent_list li:not(:last-child){margin-bottom:1.5em}.advent_list time{display:block}}@media screen and (min-width:740px){.advent_list time{margin-right:.5em}}
</style><style>h2{@apply !mt-14 text-2xl before:content-["##"] before:mr-2 before:text-primary;}h3{@apply !mt-10 text-xl before:content-["###"] before:mr-2 before:text-primary;}p code,li code{@apply text-base text-gray-800 bg-gray-200 before:content-["`"] after:content-["`"];}table{@apply mx-4 border border-solid border-gray-300 border-collapse border-spacing-0;}table tr{@apply border-b border-solid border-gray-300;}table tr:nth-child(2n){@apply bg-gray-100;}table th,table td{@apply py-2 px-4 border-r border-solid border-gray-300;}table th{@apply bg-gray-300;}blockquote{@apply py-2 pl-6 text-gray-500 border-l-4 border-solid border-gray-300;}blockquote p code{@apply text-gray-500;}blockquote>*:not(:last-child){@apply mb-4;}
</style></head> <body> <div class="wrapper"> <header class="header"> <div><a href="/">srkkr.com</a></div> </header> <main class="main">  <article> <div class="mb-12"> <h1 class="text-3xl">AT Protocolを利用してBlueskyに投稿したり投稿を取得したりなど</h1> <p class="pt-2 text-sm text-gray-800"><time datetime="2025-08-04">2025-08-04</time></p> </div> <div class="[&>*]:mb-7"> <p>AT Protocolを利用して、TypeScriptでBlueskyの自分のアカウントに投稿したり投稿一覧を見たりするメモ。</p>
<h2 id="at-protocolのインストールとディレクトリ構成">AT Protocolのインストールとディレクトリ構成</h2>
<p>プロジェクトディレクトリ内で<a href="https://www.npmjs.com/package/@atproto/api">@atproto/api</a>をインストール。ついでに<code>tsconfig.json</code>も生成する。</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.iuz5n.css"/><script type="module" src="/_astro/ec.p1z7b.js"></script><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="zsh"><code><div class="ec-line"><div class="code"><span style="--0:#A5AFA8;--0fs:italic"># @atproto/apiをインストール</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A7C080">yarn</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">add</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">@atproto/api</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#A5AFA8;--0fs:italic"># tsconfig.jsonを生成</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A7C080">npx</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">tsc</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">--init</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="yarn add @atproto/apinpx tsc --init"><div></div></button></div></figure></div>
<p>今回の構成は以下</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="zsh"><code><div class="ec-line"><div class="code"><span style="--0:#A7C080">./projectDir</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A7C080">├</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">/node_modules（@atprotoなどが入っている）</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A7C080">├</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">package.json</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A7C080">├</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">/src（ts/jsファイルを置くディレクトリ）</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A7C080">├</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">tsconfig.json</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A7C080">└</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">yarn.lock</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="./projectDir├ /node_modules（@atprotoなどが入っている）├ package.json├ /src（ts/jsファイルを置くディレクトリ）├ tsconfig.json└ yarn.lock"><div></div></button></div></figure></div>
<p><code>ts</code>ファイルは<code>/src</code>内に作成する。</p>
<h2 id="blueskyの自分の投稿を取得したりポストしたり">Blueskyの自分の投稿を取得したりポストしたり</h2>
<p>コードは以下。<code>import { BskyAgent }</code>とすると<code>BskyAgent</code>の部分に打ち消し線が入るので（非推奨？）、<code>AtpAgent</code>として実行。</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="js"><code><div class="ec-line"><div class="code"><span style="--0:#83C092">import</span><span style="--0:#D3C6AA"> { AtpAgent } </span><span style="--0:#EB9597">from</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">&#39;@atproto/api&#39;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#A5AFA8;--0fs:italic">// セッションを作成してログイン</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E79A78">const</span><span style="--0:#D3C6AA"> agent </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#EB9597">new</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">AtpAgent</span><span style="--0:#D3C6AA">({</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">service</span><span style="--0:#A5AFA8">:</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">&#39;https://bsky.social&#39;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D3C6AA">})</span></div></div><div class="ec-line"><div class="code"><span style="--0:#EB9597">await</span><span style="--0:#D3C6AA"> agent</span><span style="--0:#A5AFA8">.</span><span style="--0:#A7C080">login</span><span style="--0:#D3C6AA">({</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">identifier</span><span style="--0:#A5AFA8">:</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">&#39;Blueskyのアカウント名&#39;</span><span style="--0:#D3C6AA">, </span><span style="--0:#A5AFA8;--0fs:italic">//@以降</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">password</span><span style="--0:#A5AFA8">:</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">&#39;アプリパスワード&#39;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D3C6AA">})</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { AtpAgent } from '@atproto/api'// セッションを作成してログインconst agent = new AtpAgent({  service: 'https://bsky.social'})await agent.login({  identifier: 'Blueskyのアカウント名', //@以降  password: 'アプリパスワード'})"><div></div></button></div></figure></div>
<p><code>identifier</code>はアカウント名としてるけど、メールアドレスでもいけるっぽい。<code>password</code>はログインパスワードでもいけるけど、アプリパスワードにしておくとよさそう。</p>
<p>投稿の取得。</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="js"><code><div class="ec-line"><div class="code"><span style="--0:#E79A78">const</span><span style="--0:#D3C6AA"> tl </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#EB9597">await</span><span style="--0:#D3C6AA"> agent</span><span style="--0:#A5AFA8">.</span><span style="--0:#A7C080">getTimeline</span><span style="--0:#D3C6AA">();</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E79A78">const</span><span style="--0:#D3C6AA"> feed </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> tl</span><span style="--0:#A5AFA8">.</span><span style="--0:#D3C6AA">data</span><span style="--0:#A5AFA8">.</span><span style="--0:#D3C6AA">feed;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D3C6AA">console</span><span style="--0:#A5AFA8">.</span><span style="--0:#A7C080">log</span><span style="--0:#D3C6AA">(feed)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="const tl = await agent.getTimeline();const feed = tl.data.feed;console.log(feed)"><div></div></button></div></figure></div>
<p>アカウントにポストする。</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="js"><code><div class="ec-line"><div class="code"><span style="--0:#EB9597">await</span><span style="--0:#D3C6AA"> agent</span><span style="--0:#A5AFA8">.</span><span style="--0:#A7C080">post</span><span style="--0:#D3C6AA">({</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">text</span><span style="--0:#A5AFA8">:</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">&#39;投稿のテスト&#39;</span><span style="--0:#D3C6AA">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">createdAt</span><span style="--0:#A5AFA8">:</span><span style="--0:#D3C6AA"> </span><span style="--0:#EB9597">new</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">Date</span><span style="--0:#D3C6AA">()</span><span style="--0:#A5AFA8">.</span><span style="--0:#A7C080">toISOString</span><span style="--0:#D3C6AA">()</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D3C6AA">})</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="await agent.post({  text: '投稿のテスト',  createdAt: new Date().toISOString()})"><div></div></button></div></figure></div>
<h2 id="packagejsonの中身">package.jsonの中身</h2>
<p>とりあえず動かすことが目的なので、<code>type</code>のみ追加した。</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="json"><code><div class="ec-line"><div class="code"><span style="--0:#D3C6AA">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#E79A78">type</span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#A5AFA8">:</span><span style="--0:#D3C6AA"> </span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#A7C080">module</span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#A5AFA8">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#E79A78">dependencies</span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#A5AFA8">:</span><span style="--0:#D3C6AA"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#E79A78">@atproto/api</span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#A5AFA8">:</span><span style="--0:#D3C6AA"> </span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#A7C080">^0.16.0</span><span style="--0:#A5AFA8">&quot;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D3C6AA">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="{  &#34;type&#34;: &#34;module&#34;,  &#34;dependencies&#34;: {    &#34;@atproto/api&#34;: &#34;^0.16.0&#34;  }}"><div></div></button></div></figure></div>
<h2 id="tsconfigjsonの中身">tsconfig.jsonの中身</h2>
<p><code>/src</code>を作成しているので、そのあたりを設定。あと<code>target</code>あたりを変更している。</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="json"><code><div class="ec-line"><div class="code"><span style="--0:#D3C6AA">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A5AFA8;--0fs:italic">// Visit https://aka.ms/tsconfig to read more about this file</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#E79A78">compilerOptions</span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#A5AFA8">:</span><span style="--0:#D3C6AA"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#A5AFA8;--0fs:italic">//（略）</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#E79A78">baseUrl</span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#A5AFA8">:</span><span style="--0:#D3C6AA"> </span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#A7C080">.</span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#A5AFA8">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#E79A78">paths</span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#A5AFA8">:</span><span style="--0:#D3C6AA"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#E79A78">@atproto/*</span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#A5AFA8">:</span><span style="--0:#D3C6AA"> [</span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#A7C080">node_modules/@atproto/*</span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#D3C6AA">]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">    </span></span><span style="--0:#D3C6AA">}</span><span style="--0:#A5AFA8">,</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#A5AFA8;--0fs:italic">// Environment Settings</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#A5AFA8;--0fs:italic">// See also https://aka.ms/tsconfig/module</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#E79A78">lib</span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#A5AFA8">:</span><span style="--0:#D3C6AA"> [</span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#A7C080">ES2023</span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#A5AFA8">,</span><span style="--0:#D3C6AA"> </span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#A7C080">dom</span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#A5AFA8">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#E79A78">module</span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#A5AFA8">:</span><span style="--0:#D3C6AA"> </span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#A7C080">nodenext</span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#A5AFA8">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#E79A78">target</span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#A5AFA8">:</span><span style="--0:#D3C6AA"> </span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#A7C080">ES2023</span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#A5AFA8">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#E79A78">types</span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#A5AFA8">:</span><span style="--0:#D3C6AA"> []</span><span style="--0:#A5AFA8">,</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#A5AFA8;--0fs:italic">//（略）</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D3C6AA">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="{  // Visit https://aka.ms/tsconfig to read more about this file  &#34;compilerOptions&#34;: {    //（略）    &#34;baseUrl&#34;: &#34;.&#34;,    &#34;paths&#34;: {      &#34;@atproto/*&#34;: [&#34;node_modules/@atproto/*&#34;]    },    // Environment Settings    // See also https://aka.ms/tsconfig/module    &#34;lib&#34;: [&#34;ES2023&#34;, &#34;dom&#34;],    &#34;module&#34;: &#34;nodenext&#34;,    &#34;target&#34;: &#34;ES2023&#34;,    &#34;types&#34;: [],    //（略）  }}"><div></div></button></div></figure></div>
<p><code>paths</code>の指定の方法を少し手間取ったけど、<a href="https://www.typescriptlang.org/ja/tsconfig/#paths">TypeScriptの公式ドキュメント</a>がいちばんわかりやすかった。</p>
<h2 id="公式ドキュメント">公式ドキュメント</h2>
<ul>
<li><a href="https://docs.bsky.app">Bluesky Documentation | Bluesky</a></li>
</ul> </div> </article>  </main> <footer class="footer"> <div class="icon"><img src="/images/icon.png" alt="プロフィールアイコン" width="60" height="60"></div> <p>宙駆ける / ヤマツ</p> <address>info[at-mark]sorakakeru.info</address> <small>&copy; <a href="/">srkkr.com</a>.</small> </footer> </div> </body></html> 