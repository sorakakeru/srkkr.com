<html lang="ja"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><meta name="format-detection" content="telephone=no"><title>Blueskyã®ãƒã‚¹ãƒˆåŸ‹ã‚è¾¼ã¿æ©Ÿèƒ½ã‚’è‡ªåˆ†ã§ã¤ãã‚‹ || srkkr.com</title><meta name="description">
        <meta property="og:title" content="Blueskyã®ãƒã‚¹ãƒˆåŸ‹ã‚è¾¼ã¿æ©Ÿèƒ½ã‚’è‡ªåˆ†ã§ã¤ãã‚‹">
        <meta property="og:type" content="article">
        <meta property="og:description">
        <meta property="og:site_name" content="srkkr.com"><meta property="og:locale" content="ja_JP"><meta property="og:url" content="https://srkkr.com/srkkr.com/article/2025-bluesky-post-embed/"><meta property="og:image" content="https://srkkr.com/images/og.png"><link rel="manifest" href="/favicon/manifest.webmanifest"><link rel="icon" href="/favicon/favicon.ico" sizes="32x32"><link rel="icon" href="/favicon/icon.svg" type="image/svg+xml"><link rel="apple-touch-icon" href="/favicon/apple-touch-icon.png"><link rel="canonical" href="https://srkkr.com/srkkr.com/article/2025-bluesky-post-embed/"><style>body,p,h1,h2,h3,h4,h5,h6,ul,ol,figure,figcaption,hr{margin:0;padding:0}table{border-collapse:collapse}*,*:before,*:after{box-sizing:border-box}:root{--baseColor: #1f2937;--primaryColor: #207b7e;--whiteColor: #fefefe;--bgColor: #fefefe;--grayColor: #ccc;--grayBgColor: #eee}html{scroll-behavior:smooth}body{color:var(--baseColor);font-size:1rem;font-family:Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;line-height:1.8;background-color:var(--bgColor)}img,picture *{font-style:italic;vertical-align:middle;max-width:100%;height:auto}h1,h2,h3,h4,h5,h6,strong{font-weight:700}a{transition:all .3s}a:link,a:visited{color:var(--primaryColor);text-decoration:underline}a:hover,a:active{color:var(--baseColor);text-decoration:none}.wrapper{margin-inline:auto;padding:3.5em 0;width:min(90%,800px)}.header{margin-bottom:3em}h1{font-size:1.25em}h2{margin-bottom:.5em;font-size:1.1em}.main{margin-bottom:3em;padding-bottom:3em;border-bottom:1px dashed var(--grayColor)}ul,ol{margin-left:1.5em}hr{margin-block:2em;border:none;border-top:1px solid var(--baseColor);height:0}.footer{text-align:center}.footer .icon{margin-bottom:.5em}.footer .icon img{border-radius:50%}.footer address{margin-bottom:1.5em;font-style:normal}.footer small{font-size:.85em}.advent_list li:has(>a):not(:last-child){margin-bottom:1.5em}.advent_list li:has(>a) .advent_info{padding-left:1em;font-size:.85em;border-left:4px solid var(--grayColor)}@media screen and (max-width:739px){.advent_list time{display:block}.advent_list li:has(>a) .advent_info{margin-top:1em}}@media screen and (min-width:740px){.advent_list time{margin-right:.5em}.advent_list li:has(>a) .advent_info{margin-top:.5em}}
</style><style>.article_area h1{font-size:1.5em}.article_area h1+p{font-size:.85em}.article_area .conte{margin-top:3em;position:relative}.article_area .conte:before{content:"";background-color:var(--grayColor);width:2em;height:1px;position:absolute;top:-2.5em;left:0;display:inline-block}.article_area .conte>*:not(:where(h2,h3,h4,h5,h6,hr)){margin-bottom:1.5em}.article_area .conte>*:not(:where(h2,h3)):has(+:where(h2,h3)){margin-bottom:3.5em}.article_area .conte>*:not(:where(h4,h5,h6)):has(+:where(h4,h5,h6)){margin-bottom:2em}.article_area .conte h2{margin-bottom:.75em;padding-left:.5em;font-size:1.35em;line-height:1.4;border-left:6px solid var(--baseColor)}.article_area .conte h3{font-size:1.2em}.article_area .conte h4{font-size:1.1em}.article_area p code,.article_area li code{padding:.25em .5em;font-size:.85em;background-color:var(--grayBgColor);border-radius:2.5px}@media screen and (min-width:740px){.article_area p:has(img){margin-inline:2.5em}}
</style></head> <body> <div class="wrapper"> <header class="header"> <div><a href="/">srkkr.com</a></div> </header> <main class="main">  <article class="article_area"> <h1>Blueskyã®ãƒã‚¹ãƒˆåŸ‹ã‚è¾¼ã¿æ©Ÿèƒ½ã‚’è‡ªåˆ†ã§ã¤ãã‚‹</h1> <p><time datetime="2025-12-19">2025-12-19</time></p> <div class="conte"> <p>æœ¬è¨˜äº‹ã¯<a href="https://adventar.org/calendars/12255">Bluesky / ATProtocol Advent Calendar 2025</a> 19æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚</p>
<hr/>
<p>ãƒ¤ãƒãƒ„ã¨ç”³ã—ã¾ã™ã€‚æœ¬è¨˜äº‹ã¯Blueskyã®ãƒã‚¹ãƒˆåŸ‹ã‚è¾¼ã¿æ©Ÿèƒ½ã‚’è‡ªåˆ†ã§ã¤ãã‚‹è¨˜éŒ²ã§ã™ã€‚PHPã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚<br/>
ä»¥é™ã®å†…å®¹ã¯ã€æœ¬è¨˜äº‹å…¬é–‹æ™‚ç‚¹ã§Blueskyå…¬å¼ã«å›ºå®šã•ã‚Œã¦ã„ã‚‹<a href="https://bsky.app/profile/bsky.app/post/3l6oveex3ii2l">ã“ã¡ã‚‰ã®ãƒã‚¹ãƒˆ</a>ã§è¡Œã£ã¦ã„ã¾ã™ã€‚</p>
<h2 id="å®Ÿè£…ãƒ‡ãƒ¢ã¨åŸ‹ã‚è¾¼ã¿ã‚³ãƒ¼ãƒ‰ã®æ¦‚è¦">å®Ÿè£…ãƒ‡ãƒ¢ã¨åŸ‹ã‚è¾¼ã¿ã‚³ãƒ¼ãƒ‰ã®æ¦‚è¦</h2>
<p>Blueskyã®å€‹åˆ¥ãƒã‚¹ãƒˆURLã‚’å…¥åŠ›ã—ã¦ã€åŸ‹ã‚è¾¼ã¿ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã€è¡¨ç¤ºã™ã‚‹ã¨ã„ã†ã‚‚ã®ã§ã™ï¼ˆå‹•ç”»ã®éŒ²ç”»ã¨ç·¨é›†ãŒè‹¦æ‰‹â€¦ï¼‰</p>
<p><img src="/images/bluesky-post-embed.gif" alt="ãƒ‡ãƒ¢"/></p>
<p>Blueskyã®åŸ‹ã‚è¾¼ã¿ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«<code>blockquote</code>è¦ç´ ã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚</p>
<div class="expressive-code"><link rel="stylesheet" href="../../_astro/ec.iuz5n.css"/><script type="module" src="../../_astro/ec.p1z7b.js"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="html"><code><div class="ec-line"><div class="code"><span style="--0:#A7C080">&lt;</span><span style="--0:#E79A78">blockquote</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">class</span><span style="--0:#A7C080">=</span><span style="--0:#A7C080">&quot;bluesky-embed&quot;</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">data-bluesky-uri</span><span style="--0:#A7C080">=</span><span style="--0:#A7C080">&quot;at://did:plc:z72i7hdynmk6r22z27h6tvur/app.bsky.feed.post/3l6oveex3ii2l&quot;</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">data-bluesky-cid</span><span style="--0:#A7C080">=</span><span style="--0:#A7C080">&quot;bafyreicnt42y6vo6pfpvyro234ac4o6ijug6adwwrh7awflgrqlt4zibxq&quot;</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">data-bluesky-embed-color-mode</span><span style="--0:#A7C080">=</span><span style="--0:#A7C080">&quot;system&quot;</span><span style="--0:#A7C080">&gt;&lt;</span><span style="--0:#E79A78">p</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">lang</span><span style="--0:#A7C080">=</span><span style="--0:#A7C080">&quot;en&quot;</span><span style="--0:#A7C080">&gt;</span><span style="--0:#D3C6AA">ğŸ‘‹  Bluesky is an open social network that gives creators independence from platforms, developers the freedom to build, and users a choice in their experience. We&amp;#x27;re so excited to have you here!</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D3C6AA">We share Bluesky updates &amp;amp; news from this account. A quick orientation thread: ğŸ§µâœ¨</span><span style="--0:#A7C080">&lt;/</span><span style="--0:#E79A78">p</span><span style="--0:#A7C080">&gt;</span><span style="--0:#D3C6AA">&amp;mdash; Bluesky (</span><span style="--0:#A7C080">&lt;</span><span style="--0:#E79A78">a</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">href</span><span style="--0:#A7C080">=</span><span style="--0:#A7C080">&quot;https://bsky.app/profile/did:plc:z72i7hdynmk6r22z27h6tvur?ref_src=embed&quot;</span><span style="--0:#A7C080">&gt;</span><span style="--0:#D3C6AA">@bsky.app</span><span style="--0:#A7C080">&lt;/</span><span style="--0:#E79A78">a</span><span style="--0:#A7C080">&gt;</span><span style="--0:#D3C6AA">) </span><span style="--0:#A7C080">&lt;</span><span style="--0:#E79A78">a</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">href</span><span style="--0:#A7C080">=</span><span style="--0:#A7C080">&quot;https://bsky.app/profile/did:plc:z72i7hdynmk6r22z27h6tvur/post/3l6oveex3ii2l?ref_src=embed&quot;</span><span style="--0:#A7C080">&gt;</span><span style="--0:#D3C6AA">2024å¹´10æœˆ17æ—¥ 16:06</span><span style="--0:#A7C080">&lt;/</span><span style="--0:#E79A78">a</span><span style="--0:#A7C080">&gt;&lt;/</span><span style="--0:#E79A78">blockquote</span><span style="--0:#A7C080">&gt;&lt;</span><span style="--0:#E79A78">script</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">async</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">src</span><span style="--0:#A7C080">=</span><span style="--0:#A7C080">&quot;https://embed.bsky.app/static/embed.js&quot;</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">charset</span><span style="--0:#A7C080">=</span><span style="--0:#A7C080">&quot;utf-8&quot;</span><span style="--0:#A7C080">&gt;&lt;/</span><span style="--0:#E79A78">script</span><span style="--0:#A7C080">&gt;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="<blockquote class=&#34;bluesky-embed&#34; data-bluesky-uri=&#34;at://did:plc:z72i7hdynmk6r22z27h6tvur/app.bsky.feed.post/3l6oveex3ii2l&#34; data-bluesky-cid=&#34;bafyreicnt42y6vo6pfpvyro234ac4o6ijug6adwwrh7awflgrqlt4zibxq&#34; data-bluesky-embed-color-mode=&#34;system&#34;><p lang=&#34;en&#34;>ğŸ‘‹  Bluesky is an open social network that gives creators independence from platforms, developers the freedom to build, and users a choice in their experience. We&#38;#x27;re so excited to have you here!We share Bluesky updates &#38;amp; news from this account. A quick orientation thread: ğŸ§µâœ¨</p>&#38;mdash; Bluesky (<a href=&#34;https://bsky.app/profile/did:plc:z72i7hdynmk6r22z27h6tvur?ref_src=embed&#34;>@bsky.app</a>) <a href=&#34;https://bsky.app/profile/did:plc:z72i7hdynmk6r22z27h6tvur/post/3l6oveex3ii2l?ref_src=embed&#34;>2024å¹´10æœˆ17æ—¥ 16:06</a></blockquote><script async src=&#34;https://embed.bsky.app/static/embed.js&#34; charset=&#34;utf-8&#34;></script>"><div></div></button></div></figure></div>
<p><code>blockquote</code>è¦ç´ å†…ã®å±æ€§å€¤ã‚„æœ¬æ–‡ã¯ã€APIã‚’ä½¿ã£ã¦å–å¾—ã—ã¾ã™ã€‚</p>
<h2 id="äº‹å‰æº–å‚™">äº‹å‰æº–å‚™</h2>
<p>äº‹å‰ã«ä»¥ä¸‹ã‚’å–å¾—ã—ã¦ãŠãã¾ã™</p>
<ul>
<li>Blueskyã®ã‚¢ãƒ—ãƒªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆAPIã‚­ãƒ¼ï¼‰</li>
<li><a href="https://getcomposer.org">Composer</a>ã§<a href="https://github.com/vlucas/phpdotenv/">phpdotenv</a>ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
<ul>
<li>Composerã¯Macã ã¨<a href="https://formulae.brew.sh/formula/composer">Homebrew</a>ã§å…¥ã‚Œã‚‹ã®ãŒæ‰‹ã£å–ã‚Šæ—©ã„ã‹ã¨</li>
</ul>
</li>
<li><code>.env</code>ãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã‚’å…¥åŠ›ã—ã¦ä¿å­˜</li>
</ul>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="txt"><code><div class="ec-line"><div class="code"><span style="--0:#d3c6aa">ID=&#39;Blueskyã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ&#39;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d3c6aa">API=&#39;ã‚¢ãƒ—ãƒªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰&#39;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="ID='Blueskyã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ'API='ã‚¢ãƒ—ãƒªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰'"><div></div></button></div></figure></div>
<h2 id="ãƒ•ã‚©ãƒ¼ãƒ éƒ¨åˆ†html">ãƒ•ã‚©ãƒ¼ãƒ éƒ¨åˆ†HTML</h2>
<p>å®Ÿéš›ã«ä½¿ç”¨ã™ã‚‹å ´åˆã¯CSRFå¯¾ç­–ã‚’è¡Œã†ã®ã§ã™ãŒã€æœ¬è¨˜äº‹ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã„ã£ãŸã‚“å‰²æ„›ã—ã¾ã™ã€‚</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="html"><code><div class="ec-line"><div class="code"><span style="--0:#A7C080">&lt;</span><span style="--0:#E79A78">form</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">action</span><span style="--0:#A7C080">=</span><span style="--0:#A7C080">&quot;&quot;</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">method</span><span style="--0:#A7C080">=</span><span style="--0:#A7C080">&quot;post&quot;</span><span style="--0:#A7C080">&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A7C080">&lt;</span><span style="--0:#E79A78">input</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">type</span><span style="--0:#A7C080">=</span><span style="--0:#A7C080">&quot;text&quot;</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">name</span><span style="--0:#A7C080">=</span><span style="--0:#A7C080">&quot;url&quot;</span><span style="--0:#A7C080">&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A7C080">&lt;</span><span style="--0:#E79A78">button</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">type</span><span style="--0:#A7C080">=</span><span style="--0:#A7C080">&quot;submit&quot;</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">name</span><span style="--0:#A7C080">=</span><span style="--0:#A7C080">&quot;embed&quot;</span><span style="--0:#A7C080">&gt;</span><span style="--0:#D3C6AA">embed!</span><span style="--0:#A7C080">&lt;/</span><span style="--0:#E79A78">button</span><span style="--0:#A7C080">&gt;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A7C080">&lt;/</span><span style="--0:#E79A78">form</span><span style="--0:#A7C080">&gt;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="<form action=&#34;&#34; method=&#34;post&#34;>  <input type=&#34;text&#34; name=&#34;url&#34;>  <button type=&#34;submit&#34; name=&#34;embed&#34;>embed!</button></form>"><div></div></button></div></figure></div>
<h2 id="å‡¦ç†éƒ¨åˆ†php">å‡¦ç†éƒ¨åˆ†PHP</h2>
<p>åŸ‹ã‚è¾¼ã¿ãƒã‚¹ãƒˆç”¨ã®æƒ…å ±ã‚’å–å¾—ã—ã¦ã„ãã¾ã™ã€‚</p>
<h3 id="blueskyã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®didæƒ…å ±ã‚’å–å¾—ã™ã‚‹">Blueskyã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®DIDæƒ…å ±ã‚’å–å¾—ã™ã‚‹</h3>
<p>Blueskyã®åŸºç›¤æŠ€è¡“ã§ã‚ã‚‹AT Protocolã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è­˜åˆ¥æƒ…å ±ã¨ã—ã¦DIDãŒä½¿ã‚ã‚Œã¦ã„ã¾ã™ã€‚DIDã¯ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå›ºæœ‰ã®ã‚‚ã®ã§ã‚ã‚Šã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåã‚’å¤‰æ›´ã—ãŸã‚Šç‹¬è‡ªãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’å‰²ã‚Šå½“ã¦ãŸã¨ã—ã¦ã‚‚ã€DIDã¯å¤‰åŒ–ã—ã¾ã›ã‚“ã€‚<br/>
DIDã«ã¤ã„ã¦ã¯ã“ã®ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®1æ—¥ç›®ã€æ¡ƒè‰²è±†è…ã•ã‚“ã®ä»¥ä¸‹ã®è¨˜äº‹ã«è©³ã—ã„ã§ã™ã€‚</p>
<ul>
<li><a href="https://whtwnd.com/momoiro.me/3m6uiszqogu2p">DIDã¯çµå±€ä½•ã‚’ã—ã¦ã„ã‚‹ã®ã‹ | æ¡ƒè‰²è±†è…@Bluesky å‹‰å¼·ä¸­ | WhiteWind blog</a></li>
</ul>
<p>ä»¥ä¸‹ã¯ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®DIDæƒ…å ±ã‚’å–å¾—ã™ã‚‹ãŸã‚ã®é–¢æ•°ã§ã™ã€‚<code>com.atproto.identity.resolveHandle</code>ã‚’å©ã„ã¦å–å¾—ã—ã¾ã™ã€‚</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="php"><code><div class="ec-line"><div class="code"><span style="--0:#A5AFA8;--0fs:italic">/**</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#A5AFA8;--0fs:italic"> </span></span><span style="--0:#A5AFA8;--0fs:italic">* Blueskyã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®DIDã‚’å–å¾—</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#A5AFA8;--0fs:italic"> </span></span><span style="--0:#A5AFA8;--0fs:italic">*/</span></div></div><div class="ec-line"><div class="code"><span style="--0:#EB9597">function</span><span style="--0:#A7C080"> BlueskyDid</span><span style="--0:#D3C6AA">($bsky_handle) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">$query_url </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">&quot;https://bsky.social/xrpc/com.atproto.identity.resolveHandle?handle=</span><span style="--0:#D3C6AA">{$bsky_handle}</span><span style="--0:#DBBC7F">&quot;</span><span style="--0:#D3C6AA">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">$ch </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">curl_init</span><span style="--0:#D3C6AA">($query_url);</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A7C080">curl_setopt</span><span style="--0:#D3C6AA">($ch,</span><span style="--0:#A7C080"> CURLOPT_RETURNTRANSFER</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> </span><span style="--0:#83C092">true</span><span style="--0:#D3C6AA">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A7C080">curl_setopt</span><span style="--0:#D3C6AA">($ch,</span><span style="--0:#A7C080"> CURLOPT_HTTPHEADER</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> </span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&#39;Content-Type: application/json&#39;</span><span style="--0:#D3C6AA">]);</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A7C080">curl_setopt</span><span style="--0:#D3C6AA">($ch,</span><span style="--0:#A7C080"> CURLOPT_TIMEOUT</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> </span><span style="--0:#D79CB8">5</span><span style="--0:#D3C6AA">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A7C080">curl_setopt</span><span style="--0:#D3C6AA">($ch,</span><span style="--0:#A7C080"> CURLOPT_FAILONERROR</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> </span><span style="--0:#83C092">true</span><span style="--0:#D3C6AA">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">$result </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">curl_exec</span><span style="--0:#D3C6AA">($ch);</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A7C080">curl_close</span><span style="--0:#D3C6AA">($ch);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#EB9597">return</span><span style="--0:#D3C6AA"> $result;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D3C6AA">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="/** * Blueskyã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®DIDã‚’å–å¾— */function BlueskyDid($bsky_handle) {  $query_url = &#34;https://bsky.social/xrpc/com.atproto.identity.resolveHandle?handle={$bsky_handle}&#34;;  $ch = curl_init($query_url);  curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);  curl_setopt($ch, CURLOPT_HTTPHEADER, ['Content-Type: application/json']);  curl_setopt($ch, CURLOPT_TIMEOUT, 5);  curl_setopt($ch, CURLOPT_FAILONERROR, true);  $result = curl_exec($ch);  curl_close($ch);  return $result;}"><div></div></button></div></figure></div>
<p>ä»¥ä¸‹ã¯<code>BlueskyDid(&#39;bsky.app&#39;)</code>ã§å–å¾—ã—ãŸçµæœã§ã™ã€‚</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="json"><code><div class="ec-line"><div class="code"><span style="--0:#D3C6AA">{</span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#E79A78">did</span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#A5AFA8">:</span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#A7C080">did:plc:z72i7hdynmk6r22z27h6tvur</span><span style="--0:#A5AFA8">&quot;</span><span style="--0:#D3C6AA">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="{&#34;did&#34;:&#34;did:plc:z72i7hdynmk6r22z27h6tvur&#34;}"><div></div></button></div></figure></div>
<p>ã“ã®æƒ…å ±ã¯ã‚¢ãƒ—ãƒªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¦ã‚‰ãšã§ã€ä»¥ä¸‹ã®URLã§ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§ã‚‚å–å¾—å¯èƒ½ã§ã™ã€‚</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="txt"><code><div class="ec-line"><div class="code"><span style="--0:#d3c6aa">https://bsky.social/xrpc/com.atproto.identity.resolveHandle?handle=[Blueskyã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå]</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="https://bsky.social/xrpc/com.atproto.identity.resolveHandle?handle=[Blueskyã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå]"><div></div></button></div></figure></div>
<h4 id="å‚è€ƒæƒ…å ±">å‚è€ƒæƒ…å ±</h4>
<ul>
<li><a href="https://docs.bsky.app/docs/api/com-atproto-identity-resolve-handle">com.atproto.identity.resolveHandle | Bluesky</a></li>
</ul>
<h3 id="ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã™ã‚‹">ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã™ã‚‹</h3>
<p>åŸ‹ã‚è¾¼ã¿ãƒã‚¹ãƒˆã®æƒ…å ±ã‚’å–å¾—ã™ã‚‹ãŸã‚ã®å‰æ®µéšã¨ã—ã¦ã€ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ã¾ã™ã€‚ã“ã®å–å¾—ã«ã¯ã€Blueskyã®ã‚¢ãƒ—ãƒªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™ã€‚</p>
<p>ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã¯<code>com.atproto.server.createSession</code>ã‚’å©ã„ã¦å–å¾—ã—ã¾ã™ã€‚</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="php"><code><div class="ec-line"><div class="code"><span style="--0:#A5AFA8;--0fs:italic">//phpdotenv</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D79CB8">require</span><span style="--0:#D3C6AA"> </span><span style="--0:#83C092">__DIR__</span><span style="--0:#E79A78">.</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">&#39;/vendor/autoload.php&#39;</span><span style="--0:#D3C6AA">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#EB9597">use</span><span style="--0:#D3C6AA"> </span><span style="--0:#83C092">Dotenv</span><span style="--0:#D3C6AA">\</span><span style="--0:#7FBBB3">Dotenv</span><span style="--0:#D3C6AA">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D3C6AA">$dotenv </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#7FBBB3">Dotenv</span><span style="--0:#D3C6AA">::</span><span style="--0:#A7C080">createImmutable</span><span style="--0:#D3C6AA">(</span><span style="--0:#83C092">__DIR__</span><span style="--0:#D3C6AA">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D3C6AA">$dotenv-&gt;</span><span style="--0:#A7C080">load</span><span style="--0:#D3C6AA">();</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#A5AFA8;--0fs:italic">/**</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#A5AFA8;--0fs:italic"> </span></span><span style="--0:#A5AFA8;--0fs:italic">* ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®å–å¾—</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#A5AFA8;--0fs:italic"> </span></span><span style="--0:#A5AFA8;--0fs:italic">*/</span></div></div><div class="ec-line"><div class="code"><span style="--0:#EB9597">function</span><span style="--0:#A7C080"> getBlueskyAccessToken</span><span style="--0:#D3C6AA">($identifier,</span><span style="--0:#A7C080"> </span><span style="--0:#D3C6AA">$password) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">$login_url </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">&#39;https://bsky.social/xrpc/com.atproto.server.createSession&#39;</span><span style="--0:#D3C6AA">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">$data </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> [</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#DBBC7F">&#39;identifier&#39;</span><span style="--0:#D3C6AA"> </span><span style="--0:#E79A78">=&gt;</span><span style="--0:#D3C6AA"> $identifier,</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#DBBC7F">&#39;password&#39;</span><span style="--0:#D3C6AA"> </span><span style="--0:#E79A78">=&gt;</span><span style="--0:#D3C6AA"> $password</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">];</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">$ch </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">curl_init</span><span style="--0:#D3C6AA">($login_url);</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A7C080">curl_setopt</span><span style="--0:#D3C6AA">($ch,</span><span style="--0:#A7C080"> CURLOPT_RETURNTRANSFER</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> </span><span style="--0:#83C092">true</span><span style="--0:#D3C6AA">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A7C080">curl_setopt</span><span style="--0:#D3C6AA">($ch,</span><span style="--0:#A7C080"> CURLOPT_POST</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> </span><span style="--0:#83C092">true</span><span style="--0:#D3C6AA">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A7C080">curl_setopt</span><span style="--0:#D3C6AA">($ch,</span><span style="--0:#A7C080"> CURLOPT_POSTFIELDS</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> json_encode</span><span style="--0:#D3C6AA">($data));</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A7C080">curl_setopt</span><span style="--0:#D3C6AA">($ch,</span><span style="--0:#A7C080"> CURLOPT_HTTPHEADER</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> </span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&#39;Content-Type: application/json&#39;</span><span style="--0:#D3C6AA">]);</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A7C080">curl_setopt</span><span style="--0:#D3C6AA">($ch,</span><span style="--0:#A7C080"> CURLOPT_TIMEOUT</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> </span><span style="--0:#D79CB8">5</span><span style="--0:#D3C6AA">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A7C080">curl_setopt</span><span style="--0:#D3C6AA">($ch,</span><span style="--0:#A7C080"> CURLOPT_FAILONERROR</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> </span><span style="--0:#83C092">true</span><span style="--0:#D3C6AA">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">$response </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">curl_exec</span><span style="--0:#D3C6AA">($ch);</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A7C080">curl_close</span><span style="--0:#D3C6AA">($ch);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">$session </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">json_decode</span><span style="--0:#D3C6AA">($response,</span><span style="--0:#A7C080"> </span><span style="--0:#83C092">true</span><span style="--0:#D3C6AA">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#EB9597">return</span><span style="--0:#D3C6AA"> $session[</span><span style="--0:#DBBC7F">&#39;accessJwt&#39;</span><span style="--0:#D3C6AA">] </span><span style="--0:#E79A78">??</span><span style="--0:#D3C6AA"> </span><span style="--0:#83C092">null</span><span style="--0:#D3C6AA">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D3C6AA">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="//phpdotenvrequire __DIR__. '/vendor/autoload.php';use Dotenv\Dotenv;$dotenv = Dotenv::createImmutable(__DIR__);$dotenv->load();/** * ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®å–å¾— */function getBlueskyAccessToken($identifier, $password) {  $login_url = 'https://bsky.social/xrpc/com.atproto.server.createSession';  $data = [    'identifier' => $identifier,    'password' => $password  ];  $ch = curl_init($login_url);  curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);  curl_setopt($ch, CURLOPT_POST, true);  curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($data));  curl_setopt($ch, CURLOPT_HTTPHEADER, ['Content-Type: application/json']);  curl_setopt($ch, CURLOPT_TIMEOUT, 5);  curl_setopt($ch, CURLOPT_FAILONERROR, true);  $response = curl_exec($ch);  curl_close($ch);  $session = json_decode($response, true);  return $session['accessJwt'] ?? null;}"><div></div></button></div></figure></div>
<p><code>getBlueskyAccessToken($_ENV[&#39;ID&#39;], $_ENV[&#39;API&#39;])</code>ã§ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã§ãã¾ã™ã€‚</p>
<h4 id="å‚è€ƒæƒ…å ±-1">å‚è€ƒæƒ…å ±</h4>
<ul>
<li><a href="https://docs.bsky.app/docs/api/com-atproto-server-create-session">com.atproto.server.createSession | Bluesky</a></li>
</ul>
<h3 id="ãƒã‚¹ãƒˆæƒ…å ±ã‚’å–å¾—ã™ã‚‹">ãƒã‚¹ãƒˆæƒ…å ±ã‚’å–å¾—ã™ã‚‹</h3>
<p>æº–å‚™ãŒæ•´ã£ãŸã®ã§ã€ã„ã‚ˆã„ã‚ˆãƒã‚¹ãƒˆæƒ…å ±ã‚’å–å¾—ã—ã¾ã™ã€‚</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="php"><code><div class="ec-line"><div class="code"><span style="--0:#A5AFA8;--0fs:italic">/**</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#A5AFA8;--0fs:italic"> </span></span><span style="--0:#A5AFA8;--0fs:italic">* postã‚’å–å¾—</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#A5AFA8;--0fs:italic"> </span></span><span style="--0:#A5AFA8;--0fs:italic">*/</span></div></div><div class="ec-line"><div class="code"><span style="--0:#EB9597">function</span><span style="--0:#A7C080"> getBlueskyPost</span><span style="--0:#D3C6AA">($token,</span><span style="--0:#A7C080"> </span><span style="--0:#D3C6AA">$api_url) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">$ch </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">curl_init</span><span style="--0:#D3C6AA">($api_url);</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A7C080">curl_setopt</span><span style="--0:#D3C6AA">($ch,</span><span style="--0:#A7C080"> CURLOPT_RETURNTRANSFER</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> </span><span style="--0:#83C092">true</span><span style="--0:#D3C6AA">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A7C080">curl_setopt</span><span style="--0:#D3C6AA">($ch,</span><span style="--0:#A7C080"> CURLOPT_HTTPHEADER</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> </span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;Authorization: Bearer </span><span style="--0:#D3C6AA">{$token}</span><span style="--0:#DBBC7F">&quot;</span><span style="--0:#D3C6AA">]);</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A7C080">curl_setopt</span><span style="--0:#D3C6AA">($ch,</span><span style="--0:#A7C080"> CURLOPT_TIMEOUT</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> </span><span style="--0:#D79CB8">5</span><span style="--0:#D3C6AA">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A7C080">curl_setopt</span><span style="--0:#D3C6AA">($ch,</span><span style="--0:#A7C080"> CURLOPT_FAILONERROR</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> </span><span style="--0:#83C092">true</span><span style="--0:#D3C6AA">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">$result </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">curl_exec</span><span style="--0:#D3C6AA">($ch);</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A7C080">curl_close</span><span style="--0:#D3C6AA">($ch);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#EB9597">return</span><span style="--0:#D3C6AA"> $result;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D3C6AA">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="/** * postã‚’å–å¾— */function getBlueskyPost($token, $api_url) {  $ch = curl_init($api_url);  curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);  curl_setopt($ch, CURLOPT_HTTPHEADER, [&#34;Authorization: Bearer {$token}&#34;]);  curl_setopt($ch, CURLOPT_TIMEOUT, 5);  curl_setopt($ch, CURLOPT_FAILONERROR, true);  $result = curl_exec($ch);  curl_close($ch);  return $result;}"><div></div></button></div></figure></div>
<p><code>$token</code>ã¯ä¸Šè¨˜ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆ<code>getBlueskyAccessToken($_ENV[&#39;ID&#39;], $_ENV[&#39;API&#39;])</code>ï¼‰ã§ã™ã€‚</p>
<p><code>$api_url</code>ã¯ä»¥ä¸‹ã®è¦é ˜ã§å–å¾—ã—ã¾ã™ã€‚<code>app.bsky.feed.getPosts</code>ã‚’å©ãã¾ã™ã€‚</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="php"><code><div class="ec-line"><div class="code"><span style="--0:#D3C6AA">$account </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">BlueskyDid</span><span style="--0:#D3C6AA">(</span><span style="--0:#DBBC7F">&#39;[Blueskyã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ]&#39;</span><span style="--0:#D3C6AA">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D3C6AA">$account_data </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">json_decode</span><span style="--0:#D3C6AA">($account,</span><span style="--0:#A7C080"> </span><span style="--0:#83C092">true</span><span style="--0:#D3C6AA">) </span><span style="--0:#E79A78">?:</span><span style="--0:#D3C6AA"> [];</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D3C6AA">$api_url </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">&quot;https://bsky.social/xrpc/app.bsky.feed.getPosts?uris=at://</span><span style="--0:#D3C6AA">{$account_data[</span><span style="--0:#DBBC7F">&#39;did&#39;</span><span style="--0:#D3C6AA">]}</span><span style="--0:#DBBC7F">/app.bsky.feed.post/[ãƒã‚¹ãƒˆID]&quot;</span><span style="--0:#D3C6AA">;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$account = BlueskyDid('[Blueskyã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ]');$account_data = json_decode($account, true) ?: [];$api_url = &#34;https://bsky.social/xrpc/app.bsky.feed.getPosts?uris=at://{$account_data['did']}/app.bsky.feed.post/[ãƒã‚¹ãƒˆID]&#34;;"><div></div></button></div></figure></div>
<p><code>[ãƒã‚¹ãƒˆID]</code>ã®ã¿ã‚’å–å¾—ã™ã‚‹APIãŒãªã„ã®ã§ï¼ˆè¦‹è½ã¨ã—ã¦ã‚‹ã ã‘ã‹ã‚‚ã—ã‚Œãªã„â€¦ï¼‰ã€å®Ÿè£…ã§ã¯ãƒ•ã‚©ãƒ¼ãƒ ã«å…¥åŠ›ã•ã‚ŒãŸURLã‹ã‚‰æ­£è¦è¡¨ç¾ã‚’ä½¿ã£ã¦æŠœãå‡ºã—ã¾ã™ã€‚<code>[Blueskyã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ]</code>ã‚‚åŒæ§˜ã«URLã‹ã‚‰æŠœãå‡ºã—ã¾ã™ã€‚</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="php"><code><div class="ec-line"><div class="code"><span style="--0:#D3C6AA">$url </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">&#39;[ãƒã‚¹ãƒˆURL]&#39;</span><span style="--0:#D3C6AA">; </span><span style="--0:#A5AFA8;--0fs:italic">//ã“ã“ã§ã¯https://bsky.app/profile/bsky.app/post/3l6oveex3ii2lã‚’ä»£å…¥</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A7C080">preg_match</span><span style="--0:#D3C6AA">(</span><span style="--0:#DBBC7F">&#39;/https:</span><span style="--0:#A7C080">\/\/</span><span style="--0:#DBBC7F">bsky</span><span style="--0:#A7C080">\.</span><span style="--0:#DBBC7F">app</span><span style="--0:#A7C080">\/</span><span style="--0:#DBBC7F">profile</span><span style="--0:#A7C080">\/</span><span style="--0:#DBBC7F">(.</span><span style="--0:#E79A78">+</span><span style="--0:#DBBC7F">)</span><span style="--0:#A7C080">\/</span><span style="--0:#DBBC7F">post</span><span style="--0:#A7C080">\/</span><span style="--0:#DBBC7F">(.</span><span style="--0:#E79A78">+</span><span style="--0:#DBBC7F">)/&#39;</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> </span><span style="--0:#D3C6AA">$url,</span><span style="--0:#A7C080"> </span><span style="--0:#D3C6AA">$match);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#A5AFA8;--0fs:italic">/* var_dump($match) çµæœ</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A5AFA8;--0fs:italic">array(3) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#A5AFA8;--0fs:italic">  </span></span><span style="--0:#A5AFA8;--0fs:italic">[0]=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#A5AFA8;--0fs:italic">  </span></span><span style="--0:#A5AFA8;--0fs:italic">string(52) &quot;https://bsky.app/profile/bsky.app/post/3l6oveex3ii2l&quot;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#A5AFA8;--0fs:italic">  </span></span><span style="--0:#A5AFA8;--0fs:italic">[1]=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#A5AFA8;--0fs:italic">  </span></span><span style="--0:#A5AFA8;--0fs:italic">string(8) &quot;bsky.app&quot;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#A5AFA8;--0fs:italic">  </span></span><span style="--0:#A5AFA8;--0fs:italic">[2]=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#A5AFA8;--0fs:italic">  </span></span><span style="--0:#A5AFA8;--0fs:italic">string(13) &quot;3l6oveex3ii2l&quot;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A5AFA8;--0fs:italic">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A5AFA8;--0fs:italic">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$url = '[ãƒã‚¹ãƒˆURL]'; //ã“ã“ã§ã¯https://bsky.app/profile/bsky.app/post/3l6oveex3ii2lã‚’ä»£å…¥preg_match('/https:\/\/bsky\.app\/profile\/(.+)\/post\/(.+)/', $url, $match);/* var_dump($match) çµæœarray(3) {  [0]=>  string(52) &#34;https://bsky.app/profile/bsky.app/post/3l6oveex3ii2l&#34;  [1]=>  string(8) &#34;bsky.app&#34;  [2]=>  string(13) &#34;3l6oveex3ii2l&#34;}*/"><div></div></button></div></figure></div>
<p>ãã‚Œãã‚Œ<code>BlueskyDid($match[1])</code>ã€<code>https://bsky.social/xrpc/app.bsky.feed.getPosts?uris=at://{$account_data[&#39;did&#39;]}/app.bsky.feed.post/{$match[2]}</code>ã¨ã—ã¾ã™ã€‚</p>
<p><code>getBlueskyPost(getBlueskyAccessToken($_ENV[&#39;ID&#39;], $_ENV[&#39;API&#39;]), $api_url)</code>ã§ãƒã‚¹ãƒˆã®æƒ…å ±ã‚’å–å¾—ã—ã¾ã™ã€‚JSONå½¢å¼ã§è¿”ã£ã¦ãã‚‹ã®ã§ã€<code>json_decode()</code>ã§ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã¾ã™ã€‚ä»¥ä¸‹ã¯<code>var_dump()</code>ã—ãŸã‚‚ã®ã§ã™ã€‚</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="php"><code><div class="ec-line"><div class="code"><span style="--0:#A7C080">array</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">1</span><span style="--0:#D3C6AA">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;posts&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A7C080">array</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">1</span><span style="--0:#D3C6AA">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">    </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#D79CB8">0</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#A7C080">array</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">12</span><span style="--0:#D3C6AA">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;uri&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#D79CB8">string</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">70</span><span style="--0:#D3C6AA">) </span><span style="--0:#DBBC7F">&quot;at://did:plc:z72i7hdynmk6r22z27h6tvur/app.bsky.feed.post/3l6oveex3ii2l&quot;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;cid&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#D79CB8">string</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">59</span><span style="--0:#D3C6AA">) </span><span style="--0:#DBBC7F">&quot;bafyreicnt42y6vo6pfpvyro234ac4o6ijug6adwwrh7awflgrqlt4zibxq&quot;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;author&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A7C080">array</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">9</span><span style="--0:#D3C6AA">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">        </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;did&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#D79CB8">string</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">32</span><span style="--0:#D3C6AA">) </span><span style="--0:#DBBC7F">&quot;did:plc:z72i7hdynmk6r22z27h6tvur&quot;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">        </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;handle&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#D79CB8">string</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">8</span><span style="--0:#D3C6AA">) </span><span style="--0:#DBBC7F">&quot;bsky.app&quot;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">        </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;displayName&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#D79CB8">string</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">7</span><span style="--0:#D3C6AA">) </span><span style="--0:#DBBC7F">&quot;Bluesky&quot;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">        </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;avatar&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#D79CB8">string</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">135</span><span style="--0:#D3C6AA">) </span><span style="--0:#DBBC7F">&quot;https://cdn.bsky.app/img/avatar/plain/did:plc:z72i7hdynmk6r22z27h6tvur/bafkreihwihm6kpd6zuwhhlro75p5qks5qtrcu55jp3gddbfjsieiv7wuka@jpeg&quot;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">        </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;associated&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#A7C080">array</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">2</span><span style="--0:#D3C6AA">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">          </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;chat&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#A7C080">array</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">1</span><span style="--0:#D3C6AA">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">            </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;allowIncoming&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#D79CB8">string</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">4</span><span style="--0:#D3C6AA">) </span><span style="--0:#DBBC7F">&quot;none&quot;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">          </span></span><span style="--0:#D3C6AA">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">          </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;activitySubscription&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#A7C080">array</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">1</span><span style="--0:#D3C6AA">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">            </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;allowSubscriptions&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#D79CB8">string</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">9</span><span style="--0:#D3C6AA">) </span><span style="--0:#DBBC7F">&quot;followers&quot;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">          </span></span><span style="--0:#D3C6AA">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">        </span></span><span style="--0:#D3C6AA">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">        </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;viewer&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#A7C080">array</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">2</span><span style="--0:#D3C6AA">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">          </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;muted&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#D79CB8">bool</span><span style="--0:#D3C6AA">(</span><span style="--0:#83C092">false</span><span style="--0:#D3C6AA">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">          </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;blockedBy&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#D79CB8">bool</span><span style="--0:#D3C6AA">(</span><span style="--0:#83C092">false</span><span style="--0:#D3C6AA">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">        </span></span><span style="--0:#D3C6AA">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">        </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;labels&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#A7C080">array</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">0</span><span style="--0:#D3C6AA">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">        </span></span><span style="--0:#D3C6AA">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">        </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;createdAt&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#D79CB8">string</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">24</span><span style="--0:#D3C6AA">) </span><span style="--0:#DBBC7F">&quot;2023-04-12T04:53:57.057Z&quot;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">        </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;verification&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#A7C080">array</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">3</span><span style="--0:#D3C6AA">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">          </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;verifications&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#A7C080">array</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">0</span><span style="--0:#D3C6AA">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">          </span></span><span style="--0:#D3C6AA">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">          </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;verifiedStatus&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#D79CB8">string</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">4</span><span style="--0:#D3C6AA">) </span><span style="--0:#DBBC7F">&quot;none&quot;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">          </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;trustedVerifierStatus&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#D79CB8">string</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">5</span><span style="--0:#D3C6AA">) </span><span style="--0:#DBBC7F">&quot;valid&quot;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">        </span></span><span style="--0:#D3C6AA">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;record&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A7C080">array</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">4</span><span style="--0:#D3C6AA">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">        </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;</span><span style="--0:#D3C6AA">$type</span><span style="--0:#DBBC7F">&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#D79CB8">string</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">18</span><span style="--0:#D3C6AA">) </span><span style="--0:#DBBC7F">&quot;app.bsky.feed.post&quot;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">        </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;createdAt&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#D79CB8">string</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">24</span><span style="--0:#D3C6AA">) </span><span style="--0:#DBBC7F">&quot;2024-10-17T07:06:51.491Z&quot;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">        </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;langs&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#A7C080">array</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">1</span><span style="--0:#D3C6AA">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">          </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#D79CB8">0</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#D79CB8">string</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">2</span><span style="--0:#D3C6AA">) </span><span style="--0:#DBBC7F">&quot;en&quot;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">        </span></span><span style="--0:#D3C6AA">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">        </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;text&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#D79CB8">string</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">285</span><span style="--0:#D3C6AA">) </span><span style="--0:#DBBC7F">&quot;ğŸ‘‹  Bluesky is an open social network that gives creators independence from platforms, developers the freedom to build, and users a choice in their experience. We&#39;re so excited to have you here!</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#DBBC7F">We share Bluesky updates &amp; news from this account. A quick orientation thread: ğŸ§µâœ¨&quot;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;bookmarkCount&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#D79CB8">int</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">106</span><span style="--0:#D3C6AA">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;replyCount&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#D79CB8">int</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">3856</span><span style="--0:#D3C6AA">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;repostCount&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#D79CB8">int</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">9340</span><span style="--0:#D3C6AA">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;likeCount&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#D79CB8">int</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">62456</span><span style="--0:#D3C6AA">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;quoteCount&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#D79CB8">int</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">668</span><span style="--0:#D3C6AA">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;indexedAt&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#D79CB8">string</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">24</span><span style="--0:#D3C6AA">) </span><span style="--0:#DBBC7F">&quot;2024-10-17T07:06:51.491Z&quot;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;viewer&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A7C080">array</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">3</span><span style="--0:#D3C6AA">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">        </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;bookmarked&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#D79CB8">bool</span><span style="--0:#D3C6AA">(</span><span style="--0:#83C092">false</span><span style="--0:#D3C6AA">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">        </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;threadMuted&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#D79CB8">bool</span><span style="--0:#D3C6AA">(</span><span style="--0:#83C092">false</span><span style="--0:#D3C6AA">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">        </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;embeddingDisabled&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#D79CB8">bool</span><span style="--0:#D3C6AA">(</span><span style="--0:#83C092">false</span><span style="--0:#D3C6AA">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;labels&quot;</span><span style="--0:#D3C6AA">]</span><span style="--0:#E79A78">=&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A7C080">array</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">0</span><span style="--0:#D3C6AA">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">    </span></span><span style="--0:#D3C6AA">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D3C6AA">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="array(1) {  [&#34;posts&#34;]=>  array(1) {    [0]=>    array(12) {      [&#34;uri&#34;]=>      string(70) &#34;at://did:plc:z72i7hdynmk6r22z27h6tvur/app.bsky.feed.post/3l6oveex3ii2l&#34;      [&#34;cid&#34;]=>      string(59) &#34;bafyreicnt42y6vo6pfpvyro234ac4o6ijug6adwwrh7awflgrqlt4zibxq&#34;      [&#34;author&#34;]=>      array(9) {        [&#34;did&#34;]=>        string(32) &#34;did:plc:z72i7hdynmk6r22z27h6tvur&#34;        [&#34;handle&#34;]=>        string(8) &#34;bsky.app&#34;        [&#34;displayName&#34;]=>        string(7) &#34;Bluesky&#34;        [&#34;avatar&#34;]=>        string(135) &#34;https://cdn.bsky.app/img/avatar/plain/did:plc:z72i7hdynmk6r22z27h6tvur/bafkreihwihm6kpd6zuwhhlro75p5qks5qtrcu55jp3gddbfjsieiv7wuka@jpeg&#34;        [&#34;associated&#34;]=>        array(2) {          [&#34;chat&#34;]=>          array(1) {            [&#34;allowIncoming&#34;]=>            string(4) &#34;none&#34;          }          [&#34;activitySubscription&#34;]=>          array(1) {            [&#34;allowSubscriptions&#34;]=>            string(9) &#34;followers&#34;          }        }        [&#34;viewer&#34;]=>        array(2) {          [&#34;muted&#34;]=>          bool(false)          [&#34;blockedBy&#34;]=>          bool(false)        }        [&#34;labels&#34;]=>        array(0) {        }        [&#34;createdAt&#34;]=>        string(24) &#34;2023-04-12T04:53:57.057Z&#34;        [&#34;verification&#34;]=>        array(3) {          [&#34;verifications&#34;]=>          array(0) {          }          [&#34;verifiedStatus&#34;]=>          string(4) &#34;none&#34;          [&#34;trustedVerifierStatus&#34;]=>          string(5) &#34;valid&#34;        }      }      [&#34;record&#34;]=>      array(4) {        [&#34;$type&#34;]=>        string(18) &#34;app.bsky.feed.post&#34;        [&#34;createdAt&#34;]=>        string(24) &#34;2024-10-17T07:06:51.491Z&#34;        [&#34;langs&#34;]=>        array(1) {          [0]=>          string(2) &#34;en&#34;        }        [&#34;text&#34;]=>        string(285) &#34;ğŸ‘‹  Bluesky is an open social network that gives creators independence from platforms, developers the freedom to build, and users a choice in their experience. We're so excited to have you here!We share Bluesky updates &#38; news from this account. A quick orientation thread: ğŸ§µâœ¨&#34;      }      [&#34;bookmarkCount&#34;]=>      int(106)      [&#34;replyCount&#34;]=>      int(3856)      [&#34;repostCount&#34;]=>      int(9340)      [&#34;likeCount&#34;]=>      int(62456)      [&#34;quoteCount&#34;]=>      int(668)      [&#34;indexedAt&#34;]=>      string(24) &#34;2024-10-17T07:06:51.491Z&#34;      [&#34;viewer&#34;]=>      array(3) {        [&#34;bookmarked&#34;]=>        bool(false)        [&#34;threadMuted&#34;]=>        bool(false)        [&#34;embeddingDisabled&#34;]=>        bool(false)      }      [&#34;labels&#34;]=>      array(0) {      }    }  }}"><div></div></button></div></figure></div>
<h4 id="å‚è€ƒæƒ…å ±-2">å‚è€ƒæƒ…å ±</h4>
<ul>
<li><a href="https://docs.bsky.app/docs/api/app-bsky-feed-get-posts">app.bsky.feed.getPosts | Bluesky</a></li>
</ul>
<h3 id="åŸ‹ã‚è¾¼ã¿ç”¨htmlã‚’ç”Ÿæˆã™ã‚‹">åŸ‹ã‚è¾¼ã¿ç”¨HTMLã‚’ç”Ÿæˆã™ã‚‹</h3>
<p>ãƒã‚¹ãƒˆã®æƒ…å ±ã‚‚å–å¾—ã§ããŸã®ã§ã€æœ€å¾Œã«åŸ‹ã‚è¾¼ã¿ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã™ã€‚<code>$post_data = json_decode($post, true) ?: [];</code>ã¾ã§ã¯å…ˆã®ã‚³ãƒ¼ãƒ‰ã¨åŒã˜ã§ã™ã€‚</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="php"><code><div class="ec-line"><div class="code"><span style="--0:#A5AFA8;--0fs:italic">/**</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#A5AFA8;--0fs:italic"> </span></span><span style="--0:#A5AFA8;--0fs:italic">* åŸ‹ã‚è¾¼ã¿ç”Ÿæˆ</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#A5AFA8;--0fs:italic"> </span></span><span style="--0:#A5AFA8;--0fs:italic">*/</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D3C6AA">$url </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">&#39;https://bsky.app/profile/bsky.app/post/3l6oveex3ii2l&#39;</span><span style="--0:#D3C6AA">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#A7C080">preg_match</span><span style="--0:#D3C6AA">(</span><span style="--0:#DBBC7F">&#39;/https:</span><span style="--0:#A7C080">\/\/</span><span style="--0:#DBBC7F">bsky</span><span style="--0:#A7C080">\.</span><span style="--0:#DBBC7F">app</span><span style="--0:#A7C080">\/</span><span style="--0:#DBBC7F">profile</span><span style="--0:#A7C080">\/</span><span style="--0:#DBBC7F">(.</span><span style="--0:#E79A78">+</span><span style="--0:#DBBC7F">)</span><span style="--0:#A7C080">\/</span><span style="--0:#DBBC7F">post</span><span style="--0:#A7C080">\/</span><span style="--0:#DBBC7F">(.</span><span style="--0:#E79A78">+</span><span style="--0:#DBBC7F">)/&#39;</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> </span><span style="--0:#D3C6AA">$url,</span><span style="--0:#A7C080"> </span><span style="--0:#D3C6AA">$match);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D3C6AA">$account </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">BlueskyDid</span><span style="--0:#D3C6AA">($match[</span><span style="--0:#D79CB8">1</span><span style="--0:#D3C6AA">]);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D3C6AA">$account_data </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">json_decode</span><span style="--0:#D3C6AA">($account,</span><span style="--0:#A7C080"> </span><span style="--0:#83C092">true</span><span style="--0:#D3C6AA">) </span><span style="--0:#E79A78">?:</span><span style="--0:#D3C6AA"> [];</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D3C6AA">$api_url </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">&quot;https://bsky.social/xrpc/app.bsky.feed.getPosts?uris=at://</span><span style="--0:#D3C6AA">{$account_data[</span><span style="--0:#DBBC7F">&#39;did&#39;</span><span style="--0:#D3C6AA">]}</span><span style="--0:#DBBC7F">/app.bsky.feed.post/</span><span style="--0:#D3C6AA">{$match[</span><span style="--0:#D79CB8">2</span><span style="--0:#D3C6AA">]}</span><span style="--0:#DBBC7F">&quot;</span><span style="--0:#D3C6AA">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D3C6AA">$token </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">getBlueskyAccessToken</span><span style="--0:#D3C6AA">($_ENV[</span><span style="--0:#DBBC7F">&#39;ID&#39;</span><span style="--0:#D3C6AA">],</span><span style="--0:#A7C080"> </span><span style="--0:#D3C6AA">$_ENV[</span><span style="--0:#DBBC7F">&#39;API&#39;</span><span style="--0:#D3C6AA">]);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D3C6AA">$post </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">getBlueskyPost</span><span style="--0:#D3C6AA">($token,</span><span style="--0:#A7C080"> </span><span style="--0:#D3C6AA">$api_url);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D3C6AA">$post_data </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">json_decode</span><span style="--0:#D3C6AA">($post,</span><span style="--0:#A7C080"> </span><span style="--0:#83C092">true</span><span style="--0:#D3C6AA">) </span><span style="--0:#E79A78">?:</span><span style="--0:#D3C6AA"> [];</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#A5AFA8;--0fs:italic">//æ—¥ä»˜å¤‰æ› UTC-&gt;JST</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D3C6AA">$post_date </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#EB9597">new</span><span style="--0:#D3C6AA"> </span><span style="--0:#7FBBB3">DateTime</span><span style="--0:#D3C6AA">($post_data[</span><span style="--0:#DBBC7F">&#39;posts&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#D79CB8">0</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;record&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;createdAt&#39;</span><span style="--0:#D3C6AA">]);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D3C6AA">$post_date-&gt;</span><span style="--0:#A7C080">setTimeZone</span><span style="--0:#D3C6AA">(</span><span style="--0:#EB9597">new</span><span style="--0:#D3C6AA"> </span><span style="--0:#7FBBB3">DateTimeZone</span><span style="--0:#D3C6AA">(</span><span style="--0:#DBBC7F">&#39;Asia/Tokyo&#39;</span><span style="--0:#D3C6AA">));</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D3C6AA">$bluesky_embed </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#D3C6AA">&lt;&lt;&lt;</span><span style="--0:#E79A78">EOT</span></div></div><div class="ec-line"><div class="code"><span style="--0:#DBBC7F">&lt;blockquote class=&quot;bluesky-embed&quot; data-bluesky-uri=&quot;</span><span style="--0:#D3C6AA">{$post_data[</span><span style="--0:#DBBC7F">&#39;posts&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#D79CB8">0</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;uri&#39;</span><span style="--0:#D3C6AA">]}</span><span style="--0:#DBBC7F">&quot; data-bluesky-cid=&quot;</span><span style="--0:#D3C6AA">{$post_data[</span><span style="--0:#DBBC7F">&#39;posts&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#D79CB8">0</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;cid&#39;</span><span style="--0:#D3C6AA">]}</span><span style="--0:#DBBC7F">&quot; data-bluesky-embed-color-mode=&quot;system&quot;&gt;&lt;p lang=&quot;</span><span style="--0:#D3C6AA">{$post_data[</span><span style="--0:#DBBC7F">&#39;posts&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#D79CB8">0</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;record&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;langs&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#D79CB8">0</span><span style="--0:#D3C6AA">]}</span><span style="--0:#DBBC7F">&quot;&gt;</span><span style="--0:#D3C6AA">{$post_data[</span><span style="--0:#DBBC7F">&#39;posts&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#D79CB8">0</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;record&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;text&#39;</span><span style="--0:#D3C6AA">]}</span><span style="--0:#DBBC7F">&lt;br&gt;&lt;br&gt;&lt;a href=&quot;https://bsky.app/profile/</span><span style="--0:#D3C6AA">{$post_data[</span><span style="--0:#DBBC7F">&#39;posts&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#D79CB8">0</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;author&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;did&#39;</span><span style="--0:#D3C6AA">]}</span><span style="--0:#DBBC7F">/post/</span><span style="--0:#D3C6AA">{$match[</span><span style="--0:#D79CB8">2</span><span style="--0:#D3C6AA">]}</span><span style="--0:#DBBC7F">?ref_src=embed&quot;&gt;[image or embed]&lt;/a&gt;&lt;/p&gt;&amp;mdash; </span><span style="--0:#D3C6AA">{$post_data[</span><span style="--0:#DBBC7F">&#39;posts&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#D79CB8">0</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;author&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;displayName&#39;</span><span style="--0:#D3C6AA">]}</span><span style="--0:#DBBC7F"> (&lt;a href=&quot;https://bsky.app/profile/</span><span style="--0:#D3C6AA">{$post_data[</span><span style="--0:#DBBC7F">&#39;posts&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#D79CB8">0</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;author&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;did&#39;</span><span style="--0:#D3C6AA">]}</span><span style="--0:#DBBC7F">?ref_src=embed&quot;&gt;@</span><span style="--0:#D3C6AA">{$post_data[</span><span style="--0:#DBBC7F">&#39;posts&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#D79CB8">0</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;author&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;handle&#39;</span><span style="--0:#D3C6AA">]}</span><span style="--0:#DBBC7F">&lt;/a&gt;) &lt;a href=&quot;https://bsky.app/profile/</span><span style="--0:#D3C6AA">{$post_data[</span><span style="--0:#DBBC7F">&#39;posts&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#D79CB8">0</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;author&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;did&#39;</span><span style="--0:#D3C6AA">]}</span><span style="--0:#DBBC7F">/post/</span><span style="--0:#D3C6AA">{$match[</span><span style="--0:#D79CB8">2</span><span style="--0:#D3C6AA">]}</span><span style="--0:#DBBC7F">?ref_src=embed&quot;&gt;</span><span style="--0:#D3C6AA">{$post_date-&gt;</span><span style="--0:#A7C080">format</span><span style="--0:#D3C6AA">(</span><span style="--0:#DBBC7F">&#39;Yå¹´næœˆjæ—¥ G:i&#39;</span><span style="--0:#D3C6AA">)}</span><span style="--0:#DBBC7F">&lt;/a&gt;&lt;/blockquote&gt;&lt;script async src=&quot;https://embed.bsky.app/static/embed.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E79A78">EOT</span><span style="--0:#D3C6AA">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#A7C080">echo</span><span style="--0:#D3C6AA"> $bluesky_embed;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="/** * åŸ‹ã‚è¾¼ã¿ç”Ÿæˆ */$url = 'https://bsky.app/profile/bsky.app/post/3l6oveex3ii2l';preg_match('/https:\/\/bsky\.app\/profile\/(.+)\/post\/(.+)/', $url, $match);$account = BlueskyDid($match[1]);$account_data = json_decode($account, true) ?: [];$api_url = &#34;https://bsky.social/xrpc/app.bsky.feed.getPosts?uris=at://{$account_data['did']}/app.bsky.feed.post/{$match[2]}&#34;;$token = getBlueskyAccessToken($_ENV['ID'], $_ENV['API']);$post = getBlueskyPost($token, $api_url);$post_data = json_decode($post, true) ?: [];//æ—¥ä»˜å¤‰æ› UTC->JST$post_date = new DateTime($post_data['posts'][0]['record']['createdAt']);$post_date->setTimeZone(new DateTimeZone('Asia/Tokyo'));$bluesky_embed = <<<EOT<blockquote class=&#34;bluesky-embed&#34; data-bluesky-uri=&#34;{$post_data['posts'][0]['uri']}&#34; data-bluesky-cid=&#34;{$post_data['posts'][0]['cid']}&#34; data-bluesky-embed-color-mode=&#34;system&#34;><p lang=&#34;{$post_data['posts'][0]['record']['langs'][0]}&#34;>{$post_data['posts'][0]['record']['text']}<br><br><a href=&#34;https://bsky.app/profile/{$post_data['posts'][0]['author']['did']}/post/{$match[2]}?ref_src=embed&#34;>[image or embed]</a></p>&#38;mdash; {$post_data['posts'][0]['author']['displayName']} (<a href=&#34;https://bsky.app/profile/{$post_data['posts'][0]['author']['did']}?ref_src=embed&#34;>@{$post_data['posts'][0]['author']['handle']}</a>) <a href=&#34;https://bsky.app/profile/{$post_data['posts'][0]['author']['did']}/post/{$match[2]}?ref_src=embed&#34;>{$post_date->format('Yå¹´næœˆjæ—¥ G:i')}</a></blockquote><script async src=&#34;https://embed.bsky.app/static/embed.js&#34; charset=&#34;utf-8&#34;></script>EOT;echo $bluesky_embed;"><div></div></button></div></figure></div>
<p>ãƒã‚¹ãƒˆæƒ…å ±ã®æ—¥ä»˜ã¯UTCã§æä¾›ã•ã‚Œã‚‹ã®ã§ã€JSTã«å¤‰æ›ã—ã¾ã™ã€‚ã‚ã¨ã¯ã‚‚ã¨ã®åŸ‹ã‚è¾¼ã¿ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ãªãŒã‚‰å¿…è¦ç®‡æ‰€ã‚’<code>$post_data[&#39;posts&#39;][0]...</code>ã«æ›¸ãæ›ãˆã¦ã„ãã¾ã™ã€‚<code>echo $bluesky_embed;</code>ã§åŸ‹ã‚è¾¼ã¿ãƒã‚¹ãƒˆã‚’è¡¨ç¤ºã•ã›ã¾ã™ã€‚</p>
<p>åŸ‹ã‚è¾¼ã¿æ©Ÿèƒ½ã®è‡ªä½œã«ã¤ã„ã¦ã¯ä»¥ä¸Šã§ã™ã€‚</p>
<h2 id="ãŠã‚ã‚Šã«">ãŠã‚ã‚Šã«</h2>
<p>X(Twitter)ã®åŸ‹ã‚è¾¼ã¿è‡ªä½œã¯ä¸­èº«ã®å‡ºåŠ›ã‚’ã»ã¼<code>script</code>ã§èª­ã¿è¾¼ã‚“ã§ã‚‹ãƒªã‚½ãƒ¼ã‚¹ãŒã‚„ã£ã¦ãã‚Œã¦ã„ãŸã®ã§ã€ã‚ã‚‹ç¨‹åº¦åŒã˜ã‚ˆã†ã«ã§ãã‚‹ã ã‚ã†ã¨æ€ã£ã¦ã„ãŸã‚‰ã»ã¼å…¨éƒ¨è‡ªåˆ†ã§å–å¾—ã—ãªã‘ã‚Œã°ãªã‚‰ãªã‹ã£ãŸã®ã§ã€çµæ§‹é¢é£Ÿã‚‰ã„ã¾ã—ãŸï¼ˆç¬‘ï¼‰</p>
<p>ãƒ†ã‚­ã‚¹ãƒˆã®ã¿ãªã‚‰ãšã€URLä»˜ãã ã£ãŸã‚Šã‚µãƒ ãƒã‚¤ãƒ«ãŒåŸ‹ã‚è¾¼ã¾ã‚Œã‚‹ã‚¿ã‚¤ãƒ—ï¼ˆOGPå–å¾—ï¼‰ã®ãƒã‚¹ãƒˆã‚‚ä¸Šè¨˜ã‚³ãƒ¼ãƒ‰ã§è¡¨ç¤ºã—ã¦ãã‚Œã‚‹ã®ã§ã€ã“ã®ã‚ãŸã‚ŠãŒ<code>script</code>ã®ãƒªã‚½ãƒ¼ã‚¹ã§ã‚„ã£ã¦ãã‚Œã¦ã‚‹ã®ã‹ãªã¨æ€ã£ã¦ãŸã‚Šã€‚å€‹äººçš„ã«ã¯æ—¥ä»˜ã®è¡¨è¨˜ã‚‚è¨€èªã«åˆã‚ã›ã¦ã»ã—ã„ãªâ€¦ã¨ã‹æ€ã£ã¦ã¾ã™ï¼ˆæ—¥æœ¬èªè¡¨è¨˜ã«ã—ã¦ã‚‹ã‘ã©ã€è‹±èªè¡¨è¨˜ã«å¤‰ã‚ã£ã¦ã—ã¾ã†ã®ã§ï¼‰</p>
<p>æœ€å¾Œã«ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›ã«å¯¾å¿œï¼†classåŒ–ã—ãŸå…¨ä½“ã‚³ãƒ¼ãƒ‰ã‚’ç½®ã„ã¦ãŠãã¾ã™ã€‚<br/>
ã“ã“ã¾ã§èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚</p>
<h2 id="ä»˜éŒ²ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›classåŒ–ã—ãŸå…¨ä½“ã‚³ãƒ¼ãƒ‰">ä»˜éŒ²ï¼šãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›ï¼†classåŒ–ã—ãŸå…¨ä½“ã‚³ãƒ¼ãƒ‰</h2>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="php"><code><div class="ec-line"><div class="code"><span style="--0:#E79A78">&lt;?</span><span style="--0:#D3C6AA">php</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A7C080">session_start</span><span style="--0:#D3C6AA">();</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A5AFA8;--0fs:italic">//phpdotenv</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D79CB8">require</span><span style="--0:#D3C6AA"> </span><span style="--0:#83C092">__DIR__</span><span style="--0:#E79A78">.</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">&#39;/vendor/autoload.php&#39;</span><span style="--0:#D3C6AA">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#EB9597">use</span><span style="--0:#D3C6AA"> </span><span style="--0:#83C092">Dotenv</span><span style="--0:#D3C6AA">\</span><span style="--0:#7FBBB3">Dotenv</span><span style="--0:#D3C6AA">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">$dotenv </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#7FBBB3">Dotenv</span><span style="--0:#D3C6AA">::</span><span style="--0:#A7C080">createImmutable</span><span style="--0:#D3C6AA">(</span><span style="--0:#83C092">__DIR__</span><span style="--0:#D3C6AA">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">$dotenv-&gt;</span><span style="--0:#A7C080">load</span><span style="--0:#D3C6AA">();</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A5AFA8;--0fs:italic">//CSRFãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#EB9597">function</span><span style="--0:#A7C080"> generateToken</span><span style="--0:#D3C6AA">() {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#EB9597">return</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">bin2hex</span><span style="--0:#D3C6AA">(</span><span style="--0:#A7C080">random_bytes</span><span style="--0:#D3C6AA">(</span><span style="--0:#D79CB8">32</span><span style="--0:#D3C6AA">));</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A5AFA8;--0fs:italic">//CSRFãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#EB9597">function</span><span style="--0:#A7C080"> validateToken</span><span style="--0:#D3C6AA">($token) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#A5AFA8;--0fs:italic">//é€ä¿¡ã•ã‚Œã¦ããŸ$tokenãŒç”Ÿæˆã—ãŸãƒãƒƒã‚·ãƒ¥ã¨ä¸€è‡´ã™ã‚‹ã‹</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#EB9597">return</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">isset</span><span style="--0:#D3C6AA">($_SESSION[</span><span style="--0:#DBBC7F">&#39;token&#39;</span><span style="--0:#D3C6AA">]) </span><span style="--0:#E79A78">&amp;&amp;</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">hash_equals</span><span style="--0:#D3C6AA">($_SESSION[</span><span style="--0:#DBBC7F">&#39;token&#39;</span><span style="--0:#D3C6AA">],</span><span style="--0:#A7C080"> </span><span style="--0:#D3C6AA">$token);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A5AFA8;--0fs:italic">//XSSå¯¾ç­–</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#EB9597">function</span><span style="--0:#A7C080"> h</span><span style="--0:#D3C6AA">($str) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#EB9597">return</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">htmlspecialchars</span><span style="--0:#D3C6AA">($str,</span><span style="--0:#A7C080"> </span><span style="--0:#D79CB8">ENT_QUOTES</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> </span><span style="--0:#DBBC7F">&#39;UTF-8&#39;</span><span style="--0:#D3C6AA">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A5AFA8;--0fs:italic">//tokenç”Ÿæˆ</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#EB9597">if</span><span style="--0:#D3C6AA"> (</span><span style="--0:#A7C080">empty</span><span style="--0:#D3C6AA">($_SESSION[</span><span style="--0:#DBBC7F">&#39;token&#39;</span><span style="--0:#D3C6AA">])) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">    </span></span><span style="--0:#D3C6AA">$_SESSION[</span><span style="--0:#DBBC7F">&#39;token&#39;</span><span style="--0:#D3C6AA">] </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">generateToken</span><span style="--0:#D3C6AA">();</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">$token </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> $_SESSION[</span><span style="--0:#DBBC7F">&#39;token&#39;</span><span style="--0:#D3C6AA">];</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#EB9597">class</span><span style="--0:#D3C6AA"> </span><span style="--0:#7FBBB3">blueskyPostEmbed</span><span style="--0:#D3C6AA"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#E79A78">private</span><span style="--0:#D3C6AA"> $id;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#E79A78">private</span><span style="--0:#D3C6AA"> $api;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#E79A78">public</span><span style="--0:#A7C080"> </span><span style="--0:#EB9597">function</span><span style="--0:#A7C080"> __construct</span><span style="--0:#D3C6AA">($id,</span><span style="--0:#A7C080"> </span><span style="--0:#D3C6AA">$api)</span><span style="--0:#A7C080"> </span><span style="--0:#D3C6AA">{ </span><span style="--0:#A5AFA8;--0fs:italic">//åˆæœŸå‡¦ç†</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">$</span><span style="--0:#D79CB8">this</span><span style="--0:#D3C6AA">-&gt;id </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> $id;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">$</span><span style="--0:#D79CB8">this</span><span style="--0:#D3C6AA">-&gt;api </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> $api;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">    </span></span><span style="--0:#D3C6AA">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#A5AFA8;--0fs:italic">/**</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#A5AFA8;--0fs:italic">     </span></span><span style="--0:#A5AFA8;--0fs:italic">* Blueskyã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®DIDã‚’å–å¾—</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#A5AFA8;--0fs:italic">     </span></span><span style="--0:#A5AFA8;--0fs:italic">*/</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#E79A78">public</span><span style="--0:#A7C080"> </span><span style="--0:#EB9597">function</span><span style="--0:#A7C080"> BlueskyDid</span><span style="--0:#D3C6AA">($bsky_handle) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">$query_url </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">&quot;https://bsky.social/xrpc/com.atproto.identity.resolveHandle?handle=</span><span style="--0:#D3C6AA">{$bsky_handle}</span><span style="--0:#DBBC7F">&quot;</span><span style="--0:#D3C6AA">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">$ch </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">curl_init</span><span style="--0:#D3C6AA">($query_url);</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A7C080">curl_setopt</span><span style="--0:#D3C6AA">($ch,</span><span style="--0:#A7C080"> CURLOPT_RETURNTRANSFER</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> </span><span style="--0:#83C092">true</span><span style="--0:#D3C6AA">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A7C080">curl_setopt</span><span style="--0:#D3C6AA">($ch,</span><span style="--0:#A7C080"> CURLOPT_HTTPHEADER</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> </span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&#39;Content-Type: application/json&#39;</span><span style="--0:#D3C6AA">]);</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A7C080">curl_setopt</span><span style="--0:#D3C6AA">($ch,</span><span style="--0:#A7C080"> CURLOPT_TIMEOUT</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> </span><span style="--0:#D79CB8">5</span><span style="--0:#D3C6AA">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A7C080">curl_setopt</span><span style="--0:#D3C6AA">($ch,</span><span style="--0:#A7C080"> CURLOPT_FAILONERROR</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> </span><span style="--0:#83C092">true</span><span style="--0:#D3C6AA">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">$result </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">curl_exec</span><span style="--0:#D3C6AA">($ch);</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A7C080">curl_close</span><span style="--0:#D3C6AA">($ch);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#EB9597">return</span><span style="--0:#D3C6AA"> $result;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">    </span></span><span style="--0:#D3C6AA">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#A5AFA8;--0fs:italic">/**</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#A5AFA8;--0fs:italic">     </span></span><span style="--0:#A5AFA8;--0fs:italic">* ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®å–å¾—</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#A5AFA8;--0fs:italic">     </span></span><span style="--0:#A5AFA8;--0fs:italic">*/</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#E79A78">public</span><span style="--0:#A7C080"> </span><span style="--0:#EB9597">function</span><span style="--0:#A7C080"> getBlueskyAccessToken</span><span style="--0:#D3C6AA">() {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">$login_url </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">&#39;https://bsky.social/xrpc/com.atproto.server.createSession&#39;</span><span style="--0:#D3C6AA">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">$data </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> [</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#DBBC7F">&#39;identifier&#39;</span><span style="--0:#D3C6AA"> </span><span style="--0:#E79A78">=&gt;</span><span style="--0:#D3C6AA"> $</span><span style="--0:#D79CB8">this</span><span style="--0:#D3C6AA">-&gt;id,</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#DBBC7F">&#39;password&#39;</span><span style="--0:#D3C6AA"> </span><span style="--0:#E79A78">=&gt;</span><span style="--0:#D3C6AA"> $</span><span style="--0:#D79CB8">this</span><span style="--0:#D3C6AA">-&gt;api</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">];</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">$ch </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">curl_init</span><span style="--0:#D3C6AA">($login_url);</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A7C080">curl_setopt</span><span style="--0:#D3C6AA">($ch,</span><span style="--0:#A7C080"> CURLOPT_RETURNTRANSFER</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> </span><span style="--0:#83C092">true</span><span style="--0:#D3C6AA">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A7C080">curl_setopt</span><span style="--0:#D3C6AA">($ch,</span><span style="--0:#A7C080"> CURLOPT_POST</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> </span><span style="--0:#83C092">true</span><span style="--0:#D3C6AA">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A7C080">curl_setopt</span><span style="--0:#D3C6AA">($ch,</span><span style="--0:#A7C080"> CURLOPT_POSTFIELDS</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> json_encode</span><span style="--0:#D3C6AA">($data));</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A7C080">curl_setopt</span><span style="--0:#D3C6AA">($ch,</span><span style="--0:#A7C080"> CURLOPT_HTTPHEADER</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> </span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&#39;Content-Type: application/json&#39;</span><span style="--0:#D3C6AA">]);</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A7C080">curl_setopt</span><span style="--0:#D3C6AA">($ch,</span><span style="--0:#A7C080"> CURLOPT_TIMEOUT</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> </span><span style="--0:#D79CB8">5</span><span style="--0:#D3C6AA">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A7C080">curl_setopt</span><span style="--0:#D3C6AA">($ch,</span><span style="--0:#A7C080"> CURLOPT_FAILONERROR</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> </span><span style="--0:#83C092">true</span><span style="--0:#D3C6AA">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">$response </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">curl_exec</span><span style="--0:#D3C6AA">($ch);</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A7C080">curl_close</span><span style="--0:#D3C6AA">($ch);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">$session </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">json_decode</span><span style="--0:#D3C6AA">($response,</span><span style="--0:#A7C080"> </span><span style="--0:#83C092">true</span><span style="--0:#D3C6AA">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#EB9597">return</span><span style="--0:#D3C6AA"> $session[</span><span style="--0:#DBBC7F">&#39;accessJwt&#39;</span><span style="--0:#D3C6AA">] </span><span style="--0:#E79A78">??</span><span style="--0:#D3C6AA"> </span><span style="--0:#83C092">null</span><span style="--0:#D3C6AA">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">    </span></span><span style="--0:#D3C6AA">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#A5AFA8;--0fs:italic">/**</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#A5AFA8;--0fs:italic">     </span></span><span style="--0:#A5AFA8;--0fs:italic">* postã‚’å–å¾—</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#A5AFA8;--0fs:italic">     </span></span><span style="--0:#A5AFA8;--0fs:italic">*/</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#E79A78">public</span><span style="--0:#A7C080"> </span><span style="--0:#EB9597">function</span><span style="--0:#A7C080"> getBlueskyPost</span><span style="--0:#D3C6AA">($token,</span><span style="--0:#A7C080"> </span><span style="--0:#D3C6AA">$api_url) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">$ch </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">curl_init</span><span style="--0:#D3C6AA">($api_url);</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A7C080">curl_setopt</span><span style="--0:#D3C6AA">($ch,</span><span style="--0:#A7C080"> CURLOPT_RETURNTRANSFER</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> </span><span style="--0:#83C092">true</span><span style="--0:#D3C6AA">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A7C080">curl_setopt</span><span style="--0:#D3C6AA">($ch,</span><span style="--0:#A7C080"> CURLOPT_HTTPHEADER</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> </span><span style="--0:#D3C6AA">[</span><span style="--0:#DBBC7F">&quot;Authorization: Bearer </span><span style="--0:#D3C6AA">{$token}</span><span style="--0:#DBBC7F">&quot;</span><span style="--0:#D3C6AA">]);</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A7C080">curl_setopt</span><span style="--0:#D3C6AA">($ch,</span><span style="--0:#A7C080"> CURLOPT_TIMEOUT</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> </span><span style="--0:#D79CB8">5</span><span style="--0:#D3C6AA">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A7C080">curl_setopt</span><span style="--0:#D3C6AA">($ch,</span><span style="--0:#A7C080"> CURLOPT_FAILONERROR</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> </span><span style="--0:#83C092">true</span><span style="--0:#D3C6AA">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">$result </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">curl_exec</span><span style="--0:#D3C6AA">($ch);</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A7C080">curl_close</span><span style="--0:#D3C6AA">($ch);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#EB9597">return</span><span style="--0:#D3C6AA"> $result;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">    </span></span><span style="--0:#D3C6AA">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E79A78">?&gt;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#E79A78">&lt;!</span><span style="--0:#D3C6AA">DOCTYPE html</span><span style="--0:#E79A78">&gt;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#E79A78">&lt;</span><span style="--0:#D3C6AA">html lang</span><span style="--0:#E79A78">=</span><span style="--0:#DBBC7F">&quot;ja&quot;</span><span style="--0:#E79A78">&gt;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E79A78">&lt;</span><span style="--0:#D3C6AA">head</span><span style="--0:#E79A78">&gt;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E79A78">&lt;</span><span style="--0:#D3C6AA">meta charset</span><span style="--0:#E79A78">=</span><span style="--0:#DBBC7F">&quot;utf-8&quot;</span><span style="--0:#E79A78">&gt;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E79A78">&lt;</span><span style="--0:#D3C6AA">meta name</span><span style="--0:#E79A78">=</span><span style="--0:#DBBC7F">&quot;viewport&quot;</span><span style="--0:#D3C6AA"> content</span><span style="--0:#E79A78">=</span><span style="--0:#DBBC7F">&quot;width=device-width,initial-scale=1.0&quot;</span><span style="--0:#E79A78">&gt;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E79A78">&lt;</span><span style="--0:#D3C6AA">meta name</span><span style="--0:#E79A78">=</span><span style="--0:#DBBC7F">&quot;format-detection&quot;</span><span style="--0:#D3C6AA"> content</span><span style="--0:#E79A78">=</span><span style="--0:#DBBC7F">&quot;telephone=no&quot;</span><span style="--0:#E79A78">&gt;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E79A78">&lt;</span><span style="--0:#D3C6AA">title</span><span style="--0:#E79A78">&gt;</span><span style="--0:#D3C6AA">Bluesky post embed</span><span style="--0:#E79A78">&lt;/</span><span style="--0:#D3C6AA">title</span><span style="--0:#E79A78">&gt;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E79A78">&lt;</span><span style="--0:#D3C6AA">link rel</span><span style="--0:#E79A78">=</span><span style="--0:#DBBC7F">&quot;stylesheet&quot;</span><span style="--0:#D3C6AA"> href</span><span style="--0:#E79A78">=</span><span style="--0:#DBBC7F">&quot;https://cdn.jsdelivr.net/npm/water.css@2/out/light.css&quot;</span><span style="--0:#E79A78">&gt;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E79A78">&lt;</span><span style="--0:#D3C6AA">style</span><span style="--0:#E79A78">&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">body {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">    </span></span><span style="--0:#D3C6AA">max</span><span style="--0:#E79A78">-</span><span style="--0:#D3C6AA">width: </span><span style="--0:#D79CB8">600</span><span style="--0:#D3C6AA">px;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E79A78">.</span><span style="--0:#D3C6AA">flex {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">    </span></span><span style="--0:#D3C6AA">display: flex;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E79A78">&lt;/</span><span style="--0:#D3C6AA">style</span><span style="--0:#E79A78">&gt;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E79A78">&lt;/</span><span style="--0:#D3C6AA">head</span><span style="--0:#E79A78">&gt;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E79A78">&lt;</span><span style="--0:#D3C6AA">body</span><span style="--0:#E79A78">&gt;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#E79A78">&lt;</span><span style="--0:#D3C6AA">form action</span><span style="--0:#E79A78">=</span><span style="--0:#DBBC7F">&quot;&quot;</span><span style="--0:#D3C6AA"> method</span><span style="--0:#E79A78">=</span><span style="--0:#DBBC7F">&quot;post&quot;</span><span style="--0:#E79A78">&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E79A78">&lt;</span><span style="--0:#D3C6AA">input type</span><span style="--0:#E79A78">=</span><span style="--0:#DBBC7F">&quot;hidden&quot;</span><span style="--0:#D3C6AA"> name</span><span style="--0:#E79A78">=</span><span style="--0:#DBBC7F">&quot;token&quot;</span><span style="--0:#D3C6AA"> value</span><span style="--0:#E79A78">=</span><span style="--0:#DBBC7F">&quot;&lt;?php echo </span><span style="--0:#D3C6AA">$token</span><span style="--0:#DBBC7F">; ?&gt;&quot;</span><span style="--0:#E79A78">&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E79A78">&lt;</span><span style="--0:#D3C6AA">div </span><span style="--0:#D79CB8">class</span><span style="--0:#E79A78">=</span><span style="--0:#DBBC7F">&quot;flex&quot;</span><span style="--0:#E79A78">&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#E79A78">&lt;</span><span style="--0:#D3C6AA">input type</span><span style="--0:#E79A78">=</span><span style="--0:#DBBC7F">&quot;text&quot;</span><span style="--0:#D3C6AA"> name</span><span style="--0:#E79A78">=</span><span style="--0:#DBBC7F">&quot;url&quot;</span><span style="--0:#E79A78">&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#E79A78">&lt;</span><span style="--0:#D3C6AA">button type</span><span style="--0:#E79A78">=</span><span style="--0:#DBBC7F">&quot;submit&quot;</span><span style="--0:#D3C6AA"> name</span><span style="--0:#E79A78">=</span><span style="--0:#DBBC7F">&quot;embed&quot;</span><span style="--0:#E79A78">&gt;</span><span style="--0:#D3C6AA">embed</span><span style="--0:#E79A78">!&lt;/</span><span style="--0:#D3C6AA">button</span><span style="--0:#E79A78">&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E79A78">&lt;/</span><span style="--0:#D3C6AA">div</span><span style="--0:#E79A78">&gt;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E79A78">&lt;/</span><span style="--0:#D3C6AA">form</span><span style="--0:#E79A78">&gt;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#E79A78">&lt;?</span><span style="--0:#D3C6AA">php</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#A5AFA8;--0fs:italic">//ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#EB9597">if</span><span style="--0:#D3C6AA"> (</span><span style="--0:#A7C080">isset</span><span style="--0:#D3C6AA">($_POST[</span><span style="--0:#DBBC7F">&#39;embed&#39;</span><span style="--0:#D3C6AA">])) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#A5AFA8;--0fs:italic">//tokenç¢ºèª</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">    </span></span><span style="--0:#D3C6AA">$getToken </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">isset</span><span style="--0:#D3C6AA">($_POST[</span><span style="--0:#DBBC7F">&#39;token&#39;</span><span style="--0:#D3C6AA">]) </span><span style="--0:#E79A78">?</span><span style="--0:#D3C6AA"> $_POST[</span><span style="--0:#DBBC7F">&#39;token&#39;</span><span style="--0:#D3C6AA">] </span><span style="--0:#E79A78">:</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">&#39;&#39;</span><span style="--0:#D3C6AA">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">    </span></span><span style="--0:#D3C6AA">$validateToken </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">validateToken</span><span style="--0:#D3C6AA">($getToken);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#EB9597">if</span><span style="--0:#D3C6AA"> (</span><span style="--0:#E79A78">!</span><span style="--0:#D3C6AA">$validateToken) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A7C080">echo</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">&#39;&lt;p style=&quot;color: red;&quot;&gt;ä¸æ­£ãªæ“ä½œã‚’æ¤œå‡ºã—ãŸãŸã‚ãƒ­ã‚°ã‚¤ãƒ³ã§ãã¾ã›ã‚“ã§ã—ãŸ&lt;/p&gt;&#39;</span><span style="--0:#D3C6AA">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">    </span></span><span style="--0:#D3C6AA">} </span><span style="--0:#EB9597">else</span><span style="--0:#D3C6AA"> {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A5AFA8;--0fs:italic">/**</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#A5AFA8;--0fs:italic">       </span></span><span style="--0:#A5AFA8;--0fs:italic">* åŸ‹ã‚è¾¼ã¿ç”Ÿæˆ</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#A5AFA8;--0fs:italic">       </span></span><span style="--0:#A5AFA8;--0fs:italic">*/</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">$url </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">h</span><span style="--0:#D3C6AA">($_POST[</span><span style="--0:#DBBC7F">&#39;url&#39;</span><span style="--0:#D3C6AA">]);</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A7C080">preg_match</span><span style="--0:#D3C6AA">(</span><span style="--0:#DBBC7F">&#39;/https:</span><span style="--0:#A7C080">\/\/</span><span style="--0:#DBBC7F">bsky</span><span style="--0:#A7C080">\.</span><span style="--0:#DBBC7F">app</span><span style="--0:#A7C080">\/</span><span style="--0:#DBBC7F">profile</span><span style="--0:#A7C080">\/</span><span style="--0:#DBBC7F">(.</span><span style="--0:#E79A78">+</span><span style="--0:#DBBC7F">)</span><span style="--0:#A7C080">\/</span><span style="--0:#DBBC7F">post</span><span style="--0:#A7C080">\/</span><span style="--0:#DBBC7F">(.</span><span style="--0:#E79A78">+</span><span style="--0:#DBBC7F">)/&#39;</span><span style="--0:#D3C6AA">,</span><span style="--0:#A7C080"> </span><span style="--0:#D3C6AA">$url,</span><span style="--0:#A7C080"> </span><span style="--0:#D3C6AA">$match);</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A5AFA8;--0fs:italic">//var_dump($match);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">$client </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#EB9597">new</span><span style="--0:#D3C6AA"> </span><span style="--0:#7FBBB3">blueskyPostEmbed</span><span style="--0:#D3C6AA">($_ENV[</span><span style="--0:#DBBC7F">&#39;ID&#39;</span><span style="--0:#D3C6AA">],</span><span style="--0:#A7C080"> </span><span style="--0:#D3C6AA">$_ENV[</span><span style="--0:#DBBC7F">&#39;API&#39;</span><span style="--0:#D3C6AA">]);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">$account </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> $client-&gt;</span><span style="--0:#A7C080">BlueskyDid</span><span style="--0:#D3C6AA">($match[</span><span style="--0:#D79CB8">1</span><span style="--0:#D3C6AA">]);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">$account_data </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">json_decode</span><span style="--0:#D3C6AA">($account,</span><span style="--0:#A7C080"> </span><span style="--0:#83C092">true</span><span style="--0:#D3C6AA">) </span><span style="--0:#E79A78">?:</span><span style="--0:#D3C6AA"> [];</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">$api_url </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#DBBC7F">&quot;https://bsky.social/xrpc/app.bsky.feed.getPosts?uris=at://</span><span style="--0:#D3C6AA">{$account_data[</span><span style="--0:#DBBC7F">&#39;did&#39;</span><span style="--0:#D3C6AA">]}</span><span style="--0:#DBBC7F">/app.bsky.feed.post/</span><span style="--0:#D3C6AA">{$match[</span><span style="--0:#D79CB8">2</span><span style="--0:#D3C6AA">]}</span><span style="--0:#DBBC7F">&quot;</span><span style="--0:#D3C6AA">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">$token </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> $client-&gt;</span><span style="--0:#A7C080">getBlueskyAccessToken</span><span style="--0:#D3C6AA">();</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">$post </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> $client-&gt;</span><span style="--0:#A7C080">getBlueskyPost</span><span style="--0:#D3C6AA">($token, $api_url);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">$post_data </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#A7C080">json_decode</span><span style="--0:#D3C6AA">($post,</span><span style="--0:#A7C080"> </span><span style="--0:#83C092">true</span><span style="--0:#D3C6AA">) </span><span style="--0:#E79A78">?:</span><span style="--0:#D3C6AA"> [];</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A5AFA8;--0fs:italic">//æ—¥ä»˜å¤‰æ› UTC-&gt;JST</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">$post_date </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#EB9597">new</span><span style="--0:#D3C6AA"> </span><span style="--0:#7FBBB3">DateTime</span><span style="--0:#D3C6AA">($post_data[</span><span style="--0:#DBBC7F">&#39;posts&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#D79CB8">0</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;record&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;createdAt&#39;</span><span style="--0:#D3C6AA">]);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">$post_date-&gt;</span><span style="--0:#A7C080">setTimeZone</span><span style="--0:#D3C6AA">(</span><span style="--0:#EB9597">new</span><span style="--0:#D3C6AA"> </span><span style="--0:#7FBBB3">DateTimeZone</span><span style="--0:#D3C6AA">(</span><span style="--0:#DBBC7F">&#39;Asia/Tokyo&#39;</span><span style="--0:#D3C6AA">));</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">      </span></span><span style="--0:#D3C6AA">$bluesky_embed </span><span style="--0:#E79A78">=</span><span style="--0:#D3C6AA"> </span><span style="--0:#D3C6AA">&lt;&lt;&lt;</span><span style="--0:#E79A78">EOT</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#DBBC7F">      </span></span><span style="--0:#DBBC7F">&lt;blockquote class=&quot;bluesky-embed&quot; data-bluesky-uri=&quot;</span><span style="--0:#D3C6AA">{$post_data[</span><span style="--0:#DBBC7F">&#39;posts&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#D79CB8">0</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;uri&#39;</span><span style="--0:#D3C6AA">]}</span><span style="--0:#DBBC7F">&quot; data-bluesky-cid=&quot;</span><span style="--0:#D3C6AA">{$post_data[</span><span style="--0:#DBBC7F">&#39;posts&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#D79CB8">0</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;cid&#39;</span><span style="--0:#D3C6AA">]}</span><span style="--0:#DBBC7F">&quot; data-bluesky-embed-color-mode=&quot;system&quot;&gt;&lt;p lang=&quot;</span><span style="--0:#D3C6AA">{$post_data[</span><span style="--0:#DBBC7F">&#39;posts&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#D79CB8">0</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;record&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;langs&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#D79CB8">0</span><span style="--0:#D3C6AA">]}</span><span style="--0:#DBBC7F">&quot;&gt;</span><span style="--0:#D3C6AA">{$post_data[</span><span style="--0:#DBBC7F">&#39;posts&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#D79CB8">0</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;record&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;text&#39;</span><span style="--0:#D3C6AA">]}</span><span style="--0:#DBBC7F">&lt;br&gt;&lt;br&gt;&lt;a href=&quot;https://bsky.app/profile/</span><span style="--0:#D3C6AA">{$post_data[</span><span style="--0:#DBBC7F">&#39;posts&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#D79CB8">0</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;author&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;did&#39;</span><span style="--0:#D3C6AA">]}</span><span style="--0:#DBBC7F">/post/</span><span style="--0:#D3C6AA">{$match[</span><span style="--0:#D79CB8">2</span><span style="--0:#D3C6AA">]}</span><span style="--0:#DBBC7F">?ref_src=embed&quot;&gt;[image or embed]&lt;/a&gt;&lt;/p&gt;&amp;mdash; </span><span style="--0:#D3C6AA">{$post_data[</span><span style="--0:#DBBC7F">&#39;posts&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#D79CB8">0</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;author&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;displayName&#39;</span><span style="--0:#D3C6AA">]}</span><span style="--0:#DBBC7F"> (&lt;a href=&quot;https://bsky.app/profile/</span><span style="--0:#D3C6AA">{$post_data[</span><span style="--0:#DBBC7F">&#39;posts&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#D79CB8">0</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;author&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;did&#39;</span><span style="--0:#D3C6AA">]}</span><span style="--0:#DBBC7F">?ref_src=embed&quot;&gt;@</span><span style="--0:#D3C6AA">{$post_data[</span><span style="--0:#DBBC7F">&#39;posts&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#D79CB8">0</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;author&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;handle&#39;</span><span style="--0:#D3C6AA">]}</span><span style="--0:#DBBC7F">&lt;/a&gt;) &lt;a href=&quot;https://bsky.app/profile/</span><span style="--0:#D3C6AA">{$post_data[</span><span style="--0:#DBBC7F">&#39;posts&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#D79CB8">0</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;author&#39;</span><span style="--0:#D3C6AA">][</span><span style="--0:#DBBC7F">&#39;did&#39;</span><span style="--0:#D3C6AA">]}</span><span style="--0:#DBBC7F">/post/</span><span style="--0:#D3C6AA">{$match[</span><span style="--0:#D79CB8">2</span><span style="--0:#D3C6AA">]}</span><span style="--0:#DBBC7F">?ref_src=embed&quot;&gt;</span><span style="--0:#D3C6AA">{$post_date-&gt;</span><span style="--0:#A7C080">format</span><span style="--0:#D3C6AA">(</span><span style="--0:#DBBC7F">&#39;Yå¹´næœˆjæ—¥ G:i&#39;</span><span style="--0:#D3C6AA">)}</span><span style="--0:#DBBC7F">&lt;/a&gt;&lt;/blockquote&gt;&lt;script async src=&quot;https://embed.bsky.app/static/embed.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#E79A78">EOT</span><span style="--0:#D3C6AA">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#A7C080">echo</span><span style="--0:#D3C6AA"> $bluesky_embed;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">    </span></span><span style="--0:#D3C6AA">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D3C6AA">  </span></span><span style="--0:#D3C6AA">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E79A78">?&gt;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#E79A78">&lt;/</span><span style="--0:#D3C6AA">body</span><span style="--0:#E79A78">&gt;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E79A78">&lt;/</span><span style="--0:#D3C6AA">html</span><span style="--0:#E79A78">&gt;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="<?php  session_start();  //phpdotenv  require __DIR__. '/vendor/autoload.php';  use Dotenv\Dotenv;  $dotenv = Dotenv::createImmutable(__DIR__);  $dotenv->load();  //CSRFãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ  function generateToken() {    return bin2hex(random_bytes(32));  }  //CSRFãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼  function validateToken($token) {    //é€ä¿¡ã•ã‚Œã¦ããŸ$tokenãŒç”Ÿæˆã—ãŸãƒãƒƒã‚·ãƒ¥ã¨ä¸€è‡´ã™ã‚‹ã‹    return isset($_SESSION['token']) &#38;&#38; hash_equals($_SESSION['token'], $token);  }  //XSSå¯¾ç­–  function h($str) {    return htmlspecialchars($str, ENT_QUOTES, 'UTF-8');  }  //tokenç”Ÿæˆ  if (empty($_SESSION['token'])) {    $_SESSION['token'] = generateToken();  }  $token = $_SESSION['token'];  class blueskyPostEmbed {    private $id;    private $api;    public function __construct($id, $api) { //åˆæœŸå‡¦ç†      $this->id = $id;      $this->api = $api;    }    /**     * Blueskyã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®DIDã‚’å–å¾—     */    public function BlueskyDid($bsky_handle) {      $query_url = &#34;https://bsky.social/xrpc/com.atproto.identity.resolveHandle?handle={$bsky_handle}&#34;;      $ch = curl_init($query_url);      curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);      curl_setopt($ch, CURLOPT_HTTPHEADER, ['Content-Type: application/json']);      curl_setopt($ch, CURLOPT_TIMEOUT, 5);      curl_setopt($ch, CURLOPT_FAILONERROR, true);      $result = curl_exec($ch);      curl_close($ch);      return $result;    }    /**     * ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®å–å¾—     */    public function getBlueskyAccessToken() {      $login_url = 'https://bsky.social/xrpc/com.atproto.server.createSession';      $data = [        'identifier' => $this->id,        'password' => $this->api      ];      $ch = curl_init($login_url);      curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);      curl_setopt($ch, CURLOPT_POST, true);      curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($data));      curl_setopt($ch, CURLOPT_HTTPHEADER, ['Content-Type: application/json']);      curl_setopt($ch, CURLOPT_TIMEOUT, 5);      curl_setopt($ch, CURLOPT_FAILONERROR, true);      $response = curl_exec($ch);      curl_close($ch);      $session = json_decode($response, true);      return $session['accessJwt'] ?? null;    }    /**     * postã‚’å–å¾—     */    public function getBlueskyPost($token, $api_url) {      $ch = curl_init($api_url);      curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);      curl_setopt($ch, CURLOPT_HTTPHEADER, [&#34;Authorization: Bearer {$token}&#34;]);      curl_setopt($ch, CURLOPT_TIMEOUT, 5);      curl_setopt($ch, CURLOPT_FAILONERROR, true);      $result = curl_exec($ch);      curl_close($ch);      return $result;    }  }?><!DOCTYPE html><html lang=&#34;ja&#34;><head><meta charset=&#34;utf-8&#34;><meta name=&#34;viewport&#34; content=&#34;width=device-width,initial-scale=1.0&#34;><meta name=&#34;format-detection&#34; content=&#34;telephone=no&#34;><title>Bluesky post embed</title><link rel=&#34;stylesheet&#34; href=&#34;https://cdn.jsdelivr.net/npm/water.css@2/out/light.css&#34;><style>  body {    max-width: 600px;  }  .flex {    display: flex;  }</style></head><body><form action=&#34;&#34; method=&#34;post&#34;>  <input type=&#34;hidden&#34; name=&#34;token&#34; value=&#34;<?php echo $token; ?>&#34;>  <div class=&#34;flex&#34;>    <input type=&#34;text&#34; name=&#34;url&#34;>    <button type=&#34;submit&#34; name=&#34;embed&#34;>embed!</button>  </div></form><?php  //ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†  if (isset($_POST['embed'])) {    //tokenç¢ºèª    $getToken = isset($_POST['token']) ? $_POST['token'] : '';    $validateToken = validateToken($getToken);    if (!$validateToken) {      echo '<p style=&#34;color: red;&#34;>ä¸æ­£ãªæ“ä½œã‚’æ¤œå‡ºã—ãŸãŸã‚ãƒ­ã‚°ã‚¤ãƒ³ã§ãã¾ã›ã‚“ã§ã—ãŸ</p>';    } else {      /**       * åŸ‹ã‚è¾¼ã¿ç”Ÿæˆ       */      $url = h($_POST['url']);      preg_match('/https:\/\/bsky\.app\/profile\/(.+)\/post\/(.+)/', $url, $match);      //var_dump($match);      $client = new blueskyPostEmbed($_ENV['ID'], $_ENV['API']);      $account = $client->BlueskyDid($match[1]);      $account_data = json_decode($account, true) ?: [];      $api_url = &#34;https://bsky.social/xrpc/app.bsky.feed.getPosts?uris=at://{$account_data['did']}/app.bsky.feed.post/{$match[2]}&#34;;      $token = $client->getBlueskyAccessToken();      $post = $client->getBlueskyPost($token, $api_url);      $post_data = json_decode($post, true) ?: [];      //æ—¥ä»˜å¤‰æ› UTC->JST      $post_date = new DateTime($post_data['posts'][0]['record']['createdAt']);      $post_date->setTimeZone(new DateTimeZone('Asia/Tokyo'));      $bluesky_embed = <<<EOT      <blockquote class=&#34;bluesky-embed&#34; data-bluesky-uri=&#34;{$post_data['posts'][0]['uri']}&#34; data-bluesky-cid=&#34;{$post_data['posts'][0]['cid']}&#34; data-bluesky-embed-color-mode=&#34;system&#34;><p lang=&#34;{$post_data['posts'][0]['record']['langs'][0]}&#34;>{$post_data['posts'][0]['record']['text']}<br><br><a href=&#34;https://bsky.app/profile/{$post_data['posts'][0]['author']['did']}/post/{$match[2]}?ref_src=embed&#34;>[image or embed]</a></p>&#38;mdash; {$post_data['posts'][0]['author']['displayName']} (<a href=&#34;https://bsky.app/profile/{$post_data['posts'][0]['author']['did']}?ref_src=embed&#34;>@{$post_data['posts'][0]['author']['handle']}</a>) <a href=&#34;https://bsky.app/profile/{$post_data['posts'][0]['author']['did']}/post/{$match[2]}?ref_src=embed&#34;>{$post_date->format('Yå¹´næœˆjæ—¥ G:i')}</a></blockquote><script async src=&#34;https://embed.bsky.app/static/embed.js&#34; charset=&#34;utf-8&#34;></script>      EOT;      echo $bluesky_embed;    }  }?></body></html>"><div></div></button></div></figure></div> </div> </article>  </main> <footer class="footer"> <div class="icon"><img src="/images/icon.png" alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚¢ã‚¤ã‚³ãƒ³" width="60" height="60"></div> <p><a href="https://sorakakeru.info/">å®™é§†ã‘ã‚‹ / ãƒ¤ãƒãƒ„</a></p> <address>info[at-mark]sorakakeru.info</address> <p><small>&copy; <a href="/">srkkr.com</a>.</small></p> </footer> </div> </body></html> 